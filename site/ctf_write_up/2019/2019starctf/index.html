



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://blog.alikas.cf/ctf_write_up/2019/2019starctf/">
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="https://raw.githubusercontent.com/Alikas0/files/master/videos/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>2019 *CTF - Alikas|station</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#yy" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://blog.alikas.cf" title="Alikas|station" class="md-header-nav__button md-logo">
          
            <i class="md-icon">border_color</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Alikas|station
            </span>
            <span class="md-header-nav__topic">
              
                2019 *CTF
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/Alikas0/Alikas0.github.io/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Alikas0.github.io
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://blog.alikas.cf" title="Alikas|station" class="md-nav__button md-logo">
      
        <i class="md-icon">border_color</i>
      
    </a>
    Alikas|station
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/Alikas0/Alikas0.github.io/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Alikas0.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Homepage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Homepage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../.." title="主页" class="md-nav__link">
      主页
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../links/" title="友情链接" class="md-nav__link">
      友情链接
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      CTF Write-Up
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        CTF Write-Up
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      2018
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        2018
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../2018/2018rctf/" title="2018 RCTF" class="md-nav__link">
      2018 RCTF
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2" checked>
    
    <label class="md-nav__link" for="nav-2-2">
      2019
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        2019
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../2019aurora/" title="2019 Aurora内部赛" class="md-nav__link">
      2019 Aurora内部赛
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2019rctf/" title="2019 RCTF国际赛" class="md-nav__link">
      2019 RCTF国际赛
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        2019 *CTF
      </label>
    
    <a href="./" title="2019 *CTF" class="md-nav__link md-nav__link--active">
      2019 *CTF
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#yy" title="yy" class="md-nav__link">
    yy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fanogo" title="fanoGo" class="md-nav__link">
    fanoGo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matr1x" title="Matr1x" class="md-nav__link">
    Matr1x
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" title="去花指令和冗余代码" class="md-nav__link">
    去花指令和冗余代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" title="算法" class="md-nav__link">
    算法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="穷举求解" class="md-nav__link">
    穷举求解
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="提取" class="md-nav__link">
    提取
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="组合求值" class="md-nav__link">
    组合求值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="排列组合，穷举求解" class="md-nav__link">
    排列组合，穷举求解
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#obfuscating-macros-ii" title="Obfuscating Macros II" class="md-nav__link">
    Obfuscating Macros II
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" title="程序流程" class="md-nav__link">
    程序流程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="加密函数" class="md-nav__link">
    加密函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" title="验证" class="md-nav__link">
    验证
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2019qwb/" title="2019 强网杯" class="md-nav__link">
      2019 强网杯
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Exams
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Exams
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3-1" type="checkbox" id="nav-2-3-1">
    
    <label class="md-nav__link" for="nav-2-3-1">
      BUUCTF
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-3-1">
        BUUCTF
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../exams/buuctf/introduction/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exams/buuctf/misc/" title="MISC" class="md-nav__link">
      MISC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exams/buuctf/reverse/" title="Reverse" class="md-nav__link">
      Reverse
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3-2" type="checkbox" id="nav-2-3-2">
    
    <label class="md-nav__link" for="nav-2-3-2">
      旧版Bugku
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-3-2">
        旧版Bugku
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../exams/old_bugku/introduction/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exams/old_bugku/reverse/" title="Reverse" class="md-nav__link">
      Reverse
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3-3" type="checkbox" id="nav-2-3-3">
    
    <label class="md-nav__link" for="nav-2-3-3">
      实验吧
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-3-3">
        实验吧
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../exams/shiyanba/introduction/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exams/shiyanba/reverse/" title="Reverse" class="md-nav__link">
      Reverse
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      CTF Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        CTF Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ctf_tools/xortool/" title="Xortool" class="md-nav__link">
      Xortool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ctf_tools/ida_python/" title="IDA python" class="md-nav__link">
      IDA python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      MISC
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        MISC
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/python_script/" title="python脚本" class="md-nav__link">
      python脚本
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/big_little_ending/" title="大端序和小端序" class="md-nav__link">
      大端序和小端序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      提问的智慧
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        提问的智慧
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/introduction/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/before_you_ask/" title="在提问之前" class="md-nav__link">
      在提问之前
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/when_you_ask/" title="当你在提问时" class="md-nav__link">
      当你在提问时
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/how_to_interpret_answers/" title="如何解读答案" class="md-nav__link">
      如何解读答案
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/on_not_reacting_like_loser/" title="如何避免扮演失败者" class="md-nav__link">
      如何避免扮演失败者
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/questions_not_to_ask/" title="不该问的问题" class="md-nav__link">
      不该问的问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/good_and_bad_questions/" title="好问题与蠢问题" class="md-nav__link">
      好问题与蠢问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/if_you_cant_get_an_answer/" title="如果得不到回答" class="md-nav__link">
      如果得不到回答
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/how_to_answer_questions_in_a_helpful_way/" title="如何更好地回答问题" class="md-nav__link">
      如何更好地回答问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/how_to_ask_questions_the_smart_way/" title="完整版" class="md-nav__link">
      完整版
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      Install WSL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        Install WSL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/wsl/install/" title="安装" class="md-nav__link">
      安装
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/wsl/mklink/" title="mklink软链接到非系统盘" class="md-nav__link">
      mklink软链接到非系统盘
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/wsl/optimization/" title="子系统优化" class="md-nav__link">
      子系统优化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/wsl/questions/" title="杂七杂八问题" class="md-nav__link">
      杂七杂八问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/wsl/reference/" title="参考资料" class="md-nav__link">
      参考资料
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#yy" title="yy" class="md-nav__link">
    yy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fanogo" title="fanoGo" class="md-nav__link">
    fanoGo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matr1x" title="Matr1x" class="md-nav__link">
    Matr1x
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" title="去花指令和冗余代码" class="md-nav__link">
    去花指令和冗余代码
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" title="算法" class="md-nav__link">
    算法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="穷举求解" class="md-nav__link">
    穷举求解
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" title="提取" class="md-nav__link">
    提取
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" title="组合求值" class="md-nav__link">
    组合求值
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" title="排列组合，穷举求解" class="md-nav__link">
    排列组合，穷举求解
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#obfuscating-macros-ii" title="Obfuscating Macros II" class="md-nav__link">
    Obfuscating Macros II
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" title="程序流程" class="md-nav__link">
    程序流程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" title="加密函数" class="md-nav__link">
    加密函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" title="验证" class="md-nav__link">
    验证
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Alikas0/Alikas0.github.io/edit/master/docs/ctf_write_up/2019/2019starctf.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>2019 *CTF</h1>
                
                <p>赛后复现，学习学习！</p>
<h2 id="yy">yy</h2>
<p>题目：<a href="https://raw.githubusercontent.com/Alikas0/CTF/master/challenges/2019/StarCTF/yy.zip">yy</a></p>
<p>这题真是调和猜出来的0.0.....</p>
<p>根据调试和猜测，从yylex()函数中的yysec[]数组可以猜出合法字符为。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">yyaccept</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">range</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">yyec</span><span class="p">))</span><span class="o">:</span>
   <span class="k">if</span> <span class="n">yyec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x01</span> <span class="o">:</span>
     <span class="n">yyaccept</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
   <span class="n">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">map</span><span class="p">(</span><span class="n">chr</span><span class="p">,</span><span class="n">yyaccept</span><span class="p">)))</span>

<span class="n">yyaccept</span> <span class="o">=</span> <span class="s">&quot;*0123456789CFT_abcdefghijklmnopqrstuvwxyz{}&quot;</span>
</pre></div>
</td></tr></table>

<p>猜测为：*CTF{0123456789_abcdefghijklmnopqrstuvwxyz}</p>
<p>继续调试可发现,程序会根据输入字符从box[]中取出对应的字符替换buffer中的字符，而<code>“_”</code>则是调用aes<em>cbc</em>encrypt进行加密,并更新buffer。最终和cmp进行对比：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171</pre></div></td><td class="code"><div class="codehilite"><pre><span></span> <span class="k">switch</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="o">&amp;</span><span class="n">savedregs</span> <span class="p">)</span>
        <span class="p">{</span>
          <span class="k">case</span> <span class="mi">2u</span><span class="o">:</span>
            <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">cmp</span><span class="p">,</span> <span class="mh">0xA0uLL</span><span class="p">)</span> <span class="p">)</span>
              <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Congratulations!&quot;</span><span class="p">);</span>
            <span class="k">else</span>
              <span class="nf">puts</span><span class="p">(</span><span class="s">&quot;try again!&quot;</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">3u</span><span class="o">:</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">buffer</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">append</span><span class="p">;</span>
            <span class="n">qword_5556FE90A3E8</span> <span class="o">=</span> <span class="n">qword_5556FE90A2B8</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">7u</span><span class="o">:</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">buffer</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">append</span><span class="p">;</span>
            <span class="n">qword_5556FE90A3E8</span> <span class="o">=</span> <span class="n">qword_5556FE90A2B8</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mi">8u</span><span class="o">:</span>
            <span class="n">aes_cbc_encrypt</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0xBu</span><span class="o">:</span>
            <span class="n">aes_cbc_encrypt</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0xFu</span><span class="o">:</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v1</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x10u</span><span class="o">:</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v2</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x11u</span><span class="o">:</span>
            <span class="n">v3</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v3</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x12u</span><span class="o">:</span>
            <span class="n">v4</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v4</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x13u</span><span class="o">:</span>
            <span class="n">v5</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v5</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x14u</span><span class="o">:</span>
            <span class="n">v6</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v6</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x15u</span><span class="o">:</span>
            <span class="n">v7</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v7</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x16u</span><span class="o">:</span>
            <span class="n">v8</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v8</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x17u</span><span class="o">:</span>
            <span class="n">v9</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v9</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x18u</span><span class="o">:</span>
            <span class="n">v10</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v10</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x19u</span><span class="o">:</span>
            <span class="n">v11</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v11</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x1Au</span><span class="o">:</span>
            <span class="n">v12</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v12</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x1Bu</span><span class="o">:</span>
            <span class="n">v13</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v13</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x1Cu</span><span class="o">:</span>
            <span class="n">v14</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v14</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x1Du</span><span class="o">:</span>
            <span class="n">v15</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v15</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x1Eu</span><span class="o">:</span>
            <span class="n">v16</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v16</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x1Fu</span><span class="o">:</span>
            <span class="n">v17</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v17</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x20u</span><span class="o">:</span>
            <span class="n">v18</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v18</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">17</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x21u</span><span class="o">:</span>
            <span class="n">v19</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v19</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">18</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x22u</span><span class="o">:</span>
            <span class="n">v20</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v20</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">19</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x23u</span><span class="o">:</span>
            <span class="n">v21</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v21</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x24u</span><span class="o">:</span>
            <span class="n">v22</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v22</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">21</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x25u</span><span class="o">:</span>
            <span class="n">v23</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v23</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">22</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x26u</span><span class="o">:</span>
            <span class="n">v24</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v24</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">23</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x27u</span><span class="o">:</span>
            <span class="n">v25</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v25</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">24</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x28u</span><span class="o">:</span>
            <span class="n">v26</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v26</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">25</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x29u</span><span class="o">:</span>
            <span class="n">v27</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v27</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">26</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x2Au</span><span class="o">:</span>
            <span class="n">v28</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v28</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">27</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x2Bu</span><span class="o">:</span>
            <span class="n">v29</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v29</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">28</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x2Cu</span><span class="o">:</span>
            <span class="n">v30</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v30</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">29</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x2Du</span><span class="o">:</span>
            <span class="n">v31</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v31</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x2Eu</span><span class="o">:</span>
            <span class="n">v32</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v32</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">31</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x2Fu</span><span class="o">:</span>
            <span class="n">v33</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v33</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x30u</span><span class="o">:</span>
            <span class="n">v34</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v34</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">33</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x31u</span><span class="o">:</span>
            <span class="n">v35</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v35</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">34</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="mh">0x32u</span><span class="o">:</span>
            <span class="n">v36</span> <span class="o">=</span> <span class="n">pc</span><span class="o">++</span><span class="p">;</span>
            <span class="o">*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">buffer</span> <span class="o">+</span> <span class="n">v36</span><span class="p">)</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="mi">35</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="k">default</span><span class="o">:</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>则解密脚本如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">from</span> <span class="n">Crypto</span><span class="p">.</span><span class="n">Cipher</span> <span class="n">import</span> <span class="n">AES</span>

<span class="n">key</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;</span><span class="se">\x2B\x7E\x15\x16\x28\xAE\xD2\xA6\xAB\xF7\x15\x88\x09\xCF\x4F\x3C</span><span class="s">&quot;</span>

<span class="cp"># print(len(key))</span>

<span class="n">cmp</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
       <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xAE</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xF8</span><span class="p">,</span>
       <span class="mh">0x2A</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xCF</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0xD3</span><span class="p">,</span> <span class="mh">0xFE</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x8C</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span>
       <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0xFA</span><span class="p">,</span> <span class="mh">0xC7</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xE8</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0xD9</span><span class="p">,</span> <span class="mh">0xC3</span><span class="p">,</span>
       <span class="mh">0xA9</span><span class="p">,</span> <span class="mh">0x3C</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">,</span> <span class="mh">0xC7</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x3D</span><span class="p">,</span> <span class="mh">0xDF</span><span class="p">,</span> <span class="mh">0xBE</span><span class="p">,</span>
       <span class="mh">0xBC</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0xAB</span><span class="p">,</span> <span class="mh">0x6E</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0xAC</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x8B</span><span class="p">,</span> <span class="mh">0x9C</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span>
       <span class="mh">0xF7</span><span class="p">,</span> <span class="mh">0x5D</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xFC</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mh">0x1D</span><span class="p">,</span> <span class="mh">0xB2</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span>
       <span class="mh">0xD3</span><span class="p">,</span> <span class="mh">0x5A</span><span class="p">,</span> <span class="mh">0xDC</span><span class="p">,</span> <span class="mh">0x3A</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x9A</span><span class="p">,</span> <span class="mh">0xCA</span><span class="p">,</span> <span class="mh">0x7B</span><span class="p">,</span> <span class="mh">0xA3</span><span class="p">,</span>
       <span class="mh">0xB5</span><span class="p">,</span> <span class="mh">0xD5</span><span class="p">,</span> <span class="mh">0xF1</span><span class="p">,</span> <span class="mh">0xB2</span><span class="p">,</span> <span class="mh">0xD9</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xD2</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0xD4</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span>
       <span class="mh">0xD7</span><span class="p">,</span> <span class="mh">0x3D</span><span class="p">,</span> <span class="mh">0xC0</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xB6</span><span class="p">,</span> <span class="mh">0x9B</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span>
       <span class="mh">0xE8</span><span class="p">,</span> <span class="mh">0xA2</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0xE3</span><span class="p">,</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0xAC</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0xA9</span><span class="p">,</span>
       <span class="mh">0x2A</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0xF3</span><span class="p">,</span> <span class="mh">0xFA</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x3C</span><span class="p">,</span> <span class="mh">0xC3</span><span class="p">,</span> <span class="mh">0x5C</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x9B</span><span class="p">,</span>
       <span class="mh">0xE8</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0xD0</span><span class="p">,</span> <span class="mh">0xD4</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x5A</span><span class="p">,</span> <span class="mh">0x9E</span><span class="p">,</span> <span class="mh">0x8D</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span>
       <span class="mh">0x9B</span><span class="p">,</span> <span class="mh">0xA3</span><span class="p">,</span> <span class="mh">0xFB</span><span class="p">,</span> <span class="mh">0xAD</span><span class="p">,</span> <span class="mh">0xB6</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x3F</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x9C</span><span class="p">,</span>
       <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0xFE</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0xFE</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x4E</span><span class="p">,</span>
       <span class="mh">0xED</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xAC</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x1F</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0xCA</span><span class="p">]</span>

<span class="n">append</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0xAB</span><span class="p">,</span> <span class="mh">0x6E</span><span class="p">,</span> <span class="mh">0xAF</span><span class="p">,</span> <span class="mh">0xB1</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span>
          <span class="mh">0xFE</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x3D</span><span class="p">,</span> <span class="mh">0x1E</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">]</span>

<span class="n">box</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x82</span><span class="o">:</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="o">:</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="mh">0x86</span><span class="o">:</span><span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="mh">0x8A</span><span class="o">:</span><span class="s">&quot;d&quot;</span><span class="p">,</span> <span class="mh">0x0B</span><span class="o">:</span><span class="sc">&#39;e&#39;</span><span class="p">,</span> <span class="mh">0x11</span><span class="o">:</span><span class="sc">&#39;f&#39;</span><span class="p">,</span> <span class="mh">0x96</span><span class="o">:</span><span class="sc">&#39;g&#39;</span><span class="p">,</span> <span class="mh">0x1D</span><span class="o">:</span><span class="sc">&#39;h&#39;</span><span class="p">,</span> <span class="mh">0x27</span><span class="o">:</span><span class="sc">&#39;i&#39;</span><span class="p">,</span> <span class="mh">0xA9</span><span class="o">:</span><span class="sc">&#39;j&#39;</span><span class="p">,</span>
       <span class="mh">0x2B</span><span class="o">:</span><span class="sc">&#39;k&#39;</span><span class="p">,</span> <span class="mh">0xB1</span><span class="o">:</span><span class="sc">&#39;l&#39;</span><span class="p">,</span> <span class="mh">0xF3</span><span class="o">:</span><span class="sc">&#39;m&#39;</span><span class="p">,</span> <span class="mh">0x5E</span><span class="o">:</span><span class="sc">&#39;n&#39;</span><span class="p">,</span> <span class="mh">0x37</span><span class="o">:</span><span class="sc">&#39;o&#39;</span><span class="p">,</span> <span class="mh">0x38</span><span class="o">:</span><span class="sc">&#39;p&#39;</span><span class="p">,</span> <span class="mh">0xC2</span><span class="o">:</span><span class="sc">&#39;q&#39;</span><span class="p">,</span> <span class="mh">0x47</span><span class="o">:</span><span class="sc">&#39;r&#39;</span><span class="p">,</span> <span class="mh">0x4E</span><span class="o">:</span><span class="sc">&#39;s&#39;</span><span class="p">,</span> <span class="mh">0x4F</span><span class="o">:</span><span class="sc">&#39;t&#39;</span><span class="p">,</span>
       <span class="mh">0xD6</span><span class="o">:</span><span class="sc">&#39;u&#39;</span><span class="p">,</span> <span class="mh">0x58</span><span class="o">:</span><span class="sc">&#39;v&#39;</span><span class="p">,</span> <span class="mh">0xDE</span><span class="o">:</span><span class="sc">&#39;w&#39;</span><span class="p">,</span> <span class="mh">0xE2</span><span class="o">:</span><span class="sc">&#39;x&#39;</span><span class="p">,</span> <span class="mh">0xE5</span><span class="o">:</span><span class="sc">&#39;y&#39;</span><span class="p">,</span> <span class="mh">0xE6</span><span class="o">:</span><span class="sc">&#39;z&#39;</span><span class="p">,</span> <span class="mh">0x67</span><span class="o">:</span><span class="sc">&#39;0&#39;</span><span class="p">,</span> <span class="mh">0x6B</span><span class="o">:</span><span class="sc">&#39;1&#39;</span><span class="p">,</span> <span class="mh">0xEC</span><span class="o">:</span><span class="sc">&#39;2&#39;</span><span class="p">,</span> <span class="mh">0xED</span><span class="o">:</span><span class="sc">&#39;3&#39;</span><span class="p">,</span>
       <span class="mh">0x6F</span><span class="o">:</span><span class="sc">&#39;4&#39;</span><span class="p">,</span> <span class="mh">0xF2</span><span class="o">:</span><span class="sc">&#39;5&#39;</span><span class="p">,</span> <span class="mh">0x73</span><span class="o">:</span><span class="sc">&#39;6&#39;</span><span class="p">,</span> <span class="mh">0xF5</span><span class="o">:</span><span class="sc">&#39;7&#39;</span><span class="p">,</span> <span class="mh">0x77</span><span class="o">:</span><span class="sc">&#39;8&#39;</span><span class="p">,</span> <span class="mh">0x7F</span><span class="o">:</span><span class="sc">&#39;9&#39;</span><span class="p">}</span>

<span class="n">Cipher</span> <span class="o">=</span> <span class="n">b</span><span class="s">&quot;&quot;</span>

<span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="nl">cmp</span><span class="p">:</span>
    <span class="n">Cipher</span> <span class="o">+=</span> <span class="n">bytes</span><span class="p">([</span><span class="n">i</span><span class="p">])</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">AES</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">AES</span><span class="p">.</span><span class="n">MODE_CBC</span><span class="p">,</span><span class="n">key</span><span class="p">)</span>
<span class="n">plain</span> <span class="o">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">Cipher</span><span class="p">)</span>


<span class="n">flag</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="nl">plain</span><span class="p">:</span>
  <span class="nl">try</span><span class="p">:</span>
    <span class="n">flag</span> <span class="o">+=</span> <span class="n">box</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="n">except</span> <span class="nl">KeyError</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;_&quot;</span><span class="o">:</span>
              <span class="n">flag</span> <span class="o">+=</span> <span class="sc">&#39;_&#39;</span>
              <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<span class="cp">#yy_funct10n_1s_h4rd_and_n0_n33d_to_r3v3rs3</span>
</pre></div>
</td></tr></table>

<p>由于append中有可转化字符，所以打印出来后手动除去hhhhh........</p>
<p>最终flag如下：</p>
<p>*CTF{yy<em>funct10n</em>1s<em>h4rd</em>and<em>n0</em>n33d<em>to</em>r3v3rs3}</p>
<h2 id="fanogo">fanoGo</h2>
<p>题目：<a href="https://raw.githubusercontent.com/Alikas0/CTF/master/challenges/2019/StarCTF/fanGo.zip">fanoGo</a></p>
<p>本题一路连猜带蒙。。。</p>
<p>根据输出<code>Say something:</code>找到主要函数.......看不懂，开始调试：</p>
<p>输入后会经过<code>fano___Fano__Decode</code>函数进行解码(为什么是解码名字说的很清楚hhh),解码后长度为0x15A,由该语句确认：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="n">e</span><span class="p">.</span><span class="n">_type</span> <span class="o">==</span> <span class="p">(</span><span class="n">runtime__type_0</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x15A</span> <span class="p">)</span>
</pre></div>
</td></tr></table>

<p>后进入runtime_eqstring()函数进行对比,汇编代码如下0.0：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">B83</span>                 <span class="no">cmp</span>     <span class="no">rbx</span><span class="p">,</span> <span class="mi">40</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">B87</span>                 <span class="no">jb</span>      <span class="no">short</span> <span class="no">loc_456BC6</span>
<span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">B89</span>                 <span class="no">vmovdqu</span> <span class="no">ymm0</span><span class="p">,</span> <span class="no">ymmword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsi</span><span class="p">]</span>
<span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">B8D</span>                 <span class="no">vmovdqu</span> <span class="no">ymm1</span><span class="p">,</span> <span class="no">ymmword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rdi</span><span class="p">]</span>
<span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">B91</span>                 <span class="no">vmovdqu</span> <span class="no">ymm2</span><span class="p">,</span> <span class="no">ymmword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rsi</span><span class="err">+</span><span class="mi">20</span><span class="no">h</span><span class="p">]</span>
<span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">B96</span>                 <span class="no">vmovdqu</span> <span class="no">ymm3</span><span class="p">,</span> <span class="no">ymmword</span> <span class="no">ptr</span> <span class="p">[</span><span class="no">rdi</span><span class="err">+</span><span class="mi">20</span><span class="no">h</span><span class="p">]</span>
<span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">B9B</span>                 <span class="no">vpcmpeqb</span> <span class="no">ymm4</span><span class="p">,</span> <span class="no">ymm0</span><span class="p">,</span> <span class="no">ymm1</span>
<span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">B9F</span>                 <span class="no">vpcmpeqb</span> <span class="no">ymm5</span><span class="p">,</span> <span class="no">ymm3</span><span class="p">,</span> <span class="no">ymm2</span>
<span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">BA3</span>                 <span class="no">vpand</span>   <span class="no">ymm6</span><span class="p">,</span> <span class="no">ymm5</span><span class="p">,</span> <span class="no">ymm4</span>
<span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">BA7</span>                 <span class="no">vpmovmskb</span> <span class="no">edx</span><span class="p">,</span> <span class="no">ymm6</span>
<span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">BAB</span>                 <span class="no">add</span>     <span class="no">rsi</span><span class="p">,</span> <span class="mi">40</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">BAF</span>                 <span class="no">add</span>     <span class="no">rdi</span><span class="p">,</span> <span class="mi">40</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">BB3</span>                 <span class="no">sub</span>     <span class="no">rbx</span><span class="p">,</span> <span class="mi">40</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">BB7</span>                 <span class="no">cmp</span>     <span class="no">edx</span><span class="p">,</span> <span class="mi">0</span><span class="no">FFFFFFFFh</span>
<span class="nl">.text:</span><span class="err">0000000000456</span><span class="nf">BBD</span>                 <span class="no">jz</span>      <span class="no">short</span> <span class="no">loc_456B83</span>
</pre></div>
</td></tr></table>

<p>而调试着可以发现对比对象就是这串：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>&quot;If you cannot read all your books...fondle them---peer into them, let them fall open where they w&quot;
                       &quot;ill, read from the first sentence that arrests the eye, set them back on the shelves with your ow&quot;
                       &quot;n hands, arrange them on your own plan so that you at least know where they are. Let them be your&quot;
                       &quot; friends; let them, at any rate, be your acquaintances.&quot;
</pre></div>
</td></tr></table>

<p>尝试搜索Encode函数,还真有hhhhhh，patch上去，将上面那串进行编码就得到我们的输入。</p>
<p><img alt="" src="https://raw.githubusercontent.com/Alikas0/files/master/img/20190714132723.png" /></p>
<p>脚本：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">exp</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s2">&quot;./fanoGo&quot;</span><span class="p">)</span>

<span class="c1"># cmp = &quot;\x49\x66\x20\x79\x6F\x75\x20\x63\x61\x6E\x6E\x6F\x74\x20\x72\x65\x61\x64\x20\x61\x6C\x6C\x20\x79\x6F\x75\x72\x20\x62\x6F\x6F\x6B\x73\x2E\x2E\x2E\x66\x6F\x6E\x64\x6C\x65\x20\x74\x68\x65\x6D\x2D\x2D\x2D\x70\x65\x65\x72\x20\x69\x6E\x74\x6F\x20\x74\x68\x65\x6D\x2C\x20\x6C\x65\x74\x20\x74\x68\x65\x6D\x20\x66\x61\x6C\x6C\x20\x6F\x70\x65\x6E\x20\x77\x68\x65\x72\x65\x20\x74\x68\x65\x79\x20\x77\x69\x6C\x6C\x2C\x20\x72\x65\x61\x64\x20\x66\x72\x6F\x6D\x20\x74\x68\x65\x20\x66\x69\x72\x73\x74\x20\x73\x65\x6E\x74\x65\x6E\x63\x65\x20\x74\x68\x61\x74\x20\x61\x72\x72\x65\x73\x74\x73\x20\x74\x68\x65\x20\x65\x79\x65\x2C\x20\x73\x65\x74\x20\x74\x68\x65\x6D\x20\x62\x61\x63\x6B\x20\x6F\x6E\x20\x74\x68\x65\x20\x73\x68\x65\x6C\x76\x65\x73\x20\x77\x69\x74\x68\x20\x79\x6F\x75\x72\x20\x6F\x77\x6E\x20\x68\x61\x6E\x64\x73\x2C\x20\x61\x72\x72\x61\x6E\x67\x65\x20\x74\x68\x65\x6D\x20\x6F\x6E\x20\x79\x6F\x75\x72\x20\x6F\x77\x6E\x20\x70\x6C\x61\x6E\x20\x73\x6F\x20\x74\x68\x61\x74\x20\x79\x6F\x75\x20\x61\x74\x20\x6C\x65\x61\x73\x74\x20\x6B\x6E\x6F\x77\x20\x77\x68\x65\x72\x65\x20\x74\x68\x65\x79\x20\x61\x72\x65\x2E\x20\x4C\x65\x74\x20\x74\x68\x65\x6D\x20\x62\x65\x20\x79\x6F\x75\x72\x20\x66\x72\x69\x65\x6E\x64\x73\x3B\x20\x6C\x65\x74\x20\x74\x68\x65\x6D\x2C\x20\x61\x74\x20\x61\x6E\x79\x20\x72\x61\x74\x65\x2C\x20\x62\x65\x20\x79\x6F\x75\x72\x20\x61\x63\x71\x75\x61\x69\x6E\x74\x61\x6E\x63\x65\x73\x2E\x00&quot;</span>

<span class="nb">cmp</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\x2B\x60\xC3\xBE\xC2\xB7\xC2\x82\xC2\x89\xC3\x95\x5B\xC2\x87\x2A\x69\x13\xC2\x96\x51\xC3\xBD\x6F\x32\x28\x5A\xC3\x92\x74\xC2\x94\xC2\x94\xC2\x95\xC2\x96\xC2\xA4\xC3\x8A\xC2\xA3\xC3\x8E\xC2\xB3\x24\x24\x24\xC2\xBA\xC2\xAE\x46\x2B\xC2\xAC\x3C\xC3\xAB\x32\x23\x2A\xC3\xB0\xC3\xB3\xC2\xAC\xC3\x85\xC2\x87\x2C\xC2\xA3\x6B\xC2\xAD\x0F\xC3\x87\x5C\xC2\xA8\xC3\xB3\xC2\xAF\xC3\xA1\xC3\xB9\x12\xC3\x8A\x44\x72\xC2\xA6\xC2\x91\x66\x6D\x31\xC3\xA7\x51\x64\x67\x78\x75\x6B\xC2\x96\xC2\x91\x51\xC3\xA7\x3E\x13\xC3\x8E\x57\x7B\x47\xC2\x9D\x45\x7F\x29\x11\xC3\x95\xC3\xA1\xC3\xA7\x59\xC2\x8A\x06\xC2\x8C\xC2\x91\xC2\xB5\x0F\x3A\xC2\x8E\xC2\xBA\xC3\x8B\xC3\xAA\xC3\xA8\xC3\xBC\xC2\x8E\x71\xC3\xBD\x6F\x32\x36\xC3\xB9\x42\xC3\xA7\x49\xC3\x92\x22\x79\xC3\x89\xC3\x93\x54\x79\xC3\x96\x63\x6A\x1F\xC3\x96\xC3\xB3\x23\x6F\xC2\x94\x37\xC2\x94\xC3\xA8\x76\xC3\x83\xC3\x8E\x7C\x3F\xC2\xAD\xC3\xA0\xC2\x9F\x0C\xC2\xAA\x7B\xC3\x83\x26\xC2\xAD\xC3\xB0\x7E\x3A\xC3\xA5\x47\xC2\x9D\x7F\x09\xC3\xA5\x49\x44\xC2\xB0\xC2\xAF\x0F\x3A\xC3\x8C\x50\x51\xC3\xBD\x6F\x32\x2C\xC3\x8C\x2D\x27\x49\xC3\xA3\x2A\xC3\xB0\xC3\xB3\xC2\xAC\xC3\x88\xC2\x89\xC3\xB0\xC2\x9D\x7E\x1C\xC2\x9F\x29\x11\x41\x47\xC3\xB5\xC2\xBC\xC3\x88\xC2\x9A\x38\xC3\xB0\xC3\xA2\xC2\xB8\xC3\xA9\x15\xC3\x92\x50</span><span class="s2">&quot;</span>

<span class="n">exp</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&quot;Say something:&quot;</span><span class="p">,</span><span class="nb">cmp</span><span class="p">)</span>

<span class="n">exp</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>由于是后面做的，端口已经关了,所以只能本地打了hhhhhh</p>
<p><img alt="" src="https://raw.githubusercontent.com/Alikas0/files/master/img/20190714132914.png" /></p>
<h2 id="matr1x">Matr1x</h2>
<p>题目：<a href="hhttps://raw.githubusercontent.com/Alikas0/CTF/master/challenges/2019/StarCTF/Matr1x.zip">Matr1x</a></p>
<p>题目一打开，通过start找到main函数。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nl">.text:</span><span class="err">00002620</span> <span class="nf">start</span>           <span class="no">proc</span> <span class="no">near</span>               <span class="c">; DATA XREF: LOAD:00000018↑o</span>
<span class="nl">.text:</span><span class="err">00002620</span>                 <span class="nf">xor</span>     <span class="no">ebp</span><span class="p">,</span> <span class="no">ebp</span>
<span class="nl">.text:</span><span class="err">00002622</span>                 <span class="nf">pop</span>     <span class="no">esi</span>
<span class="nl">.text:</span><span class="err">00002623</span>                 <span class="nf">mov</span>     <span class="no">ecx</span><span class="p">,</span> <span class="no">esp</span>
<span class="nl">.text:</span><span class="err">00002625</span>                 <span class="nf">and</span>     <span class="no">esp</span><span class="p">,</span> <span class="mi">0</span><span class="no">FFFFFFF0h</span>
<span class="nl">.text:</span><span class="err">00002628</span>                 <span class="nf">push</span>    <span class="no">eax</span>
<span class="nl">.text:</span><span class="err">00002629</span>                 <span class="nf">push</span>    <span class="no">esp</span>             <span class="c">; stack_end</span>
<span class="nl">.text:</span><span class="err">0000262</span><span class="nf">A</span>                 <span class="no">push</span>    <span class="no">edx</span>             <span class="c">; rtld_fini</span>
<span class="nl">.text:</span><span class="err">0000262</span><span class="nf">B</span>                 <span class="no">call</span>    <span class="no">sub_2652</span>
<span class="nl">.text:</span><span class="err">00002630</span>                 <span class="nf">add</span>     <span class="no">ebx</span><span class="p">,</span> <span class="mi">10994</span><span class="no">h</span>
<span class="nl">.text:</span><span class="err">00002636</span>                 <span class="nf">lea</span>     <span class="no">eax</span><span class="p">,</span> <span class="p">(</span><span class="no">nullsub_1</span> <span class="p">-</span> <span class="mi">12</span><span class="no">FC4h</span><span class="p">)[</span><span class="no">ebx</span><span class="p">]</span>
<span class="nl">.text:</span><span class="err">0000263</span><span class="nf">C</span>                 <span class="no">push</span>    <span class="no">eax</span>             <span class="c">; fini</span>
<span class="nl">.text:</span><span class="err">0000263</span><span class="nf">D</span>                 <span class="no">lea</span>     <span class="no">eax</span><span class="p">,</span> <span class="p">(</span><span class="no">sub_11250</span> <span class="p">-</span> <span class="mi">12</span><span class="no">FC4h</span><span class="p">)[</span><span class="no">ebx</span><span class="p">]</span>
<span class="nl">.text:</span><span class="err">00002643</span>                 <span class="nf">push</span>    <span class="no">eax</span>             <span class="c">; init</span>
<span class="nl">.text:</span><span class="err">00002644</span>                 <span class="nf">push</span>    <span class="no">ecx</span>             <span class="c">; ubp_av</span>
<span class="nl">.text:</span><span class="err">00002645</span>                 <span class="nf">push</span>    <span class="no">esi</span>             <span class="c">; argc</span>
<span class="nl">.text:</span><span class="err">00002646</span>                 <span class="nf">push</span>    <span class="no">ds</span><span class="p">:(</span><span class="no">off_12FF8</span> <span class="p">-</span> <span class="mi">12</span><span class="no">FC4h</span><span class="p">)[</span><span class="no">ebx</span><span class="p">]</span> <span class="c">; main</span>
<span class="nl">.text:</span><span class="err">0000264</span><span class="nf">C</span>                 <span class="no">call</span>    <span class="no">___libc_start_main</span>
<span class="nl">.text:</span><span class="err">00002651</span>                 <span class="nf">hlt</span>
<span class="nl">.text:</span><span class="err">00002651</span> <span class="nf">start</span>           <span class="no">endp</span>
<span class="nl">.text:</span><span class="err">00002651</span>
</pre></div>
</td></tr></table>

<h3 id="_1">去花指令和冗余代码</h3>
<p>.....一堆花指令和冗余代码。那就去掉咯。</p>
<p>其中，除去全局变量的代码如果之间在全局变量赋值处patch会出问题，来自Apeng大佬的指导：</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>问题出在pie的重定位上了，由于程序原本开启了pie，对全局变量引用的时候地址是会变的，所以elf运行的时候会把所有这些全局变量的引用都patch成重定位之后的。而他查找的方式肯定不是根据语句来查，可能是有个表，所以所有这些全局变量都会被patch。所以只需要把mov eax,0xxx这句话patch到其他地方就行了</p>
</div>
<p>所以稍微修改了一下，最终如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">bg</span> <span class="o">=</span> <span class="mh">0x00002620</span>
<span class="n">end</span> <span class="o">=</span> <span class="mh">0x00011320</span>
<span class="n">addr</span> <span class="o">=</span> <span class="n">bg</span>
<span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>


<span class="k">def</span> <span class="nf">patch_nop</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="n">begin</span><span class="p">:</span>
        <span class="n">PatchByte</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">)</span>
        <span class="n">begin</span> <span class="o">+=</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">next_instr</span><span class="p">(</span><span class="n">addr</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">addr</span> <span class="o">+</span> <span class="n">ItemSize</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">patch_global</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">eax</span><span class="p">):</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">GetMnem</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
    <span class="n">ebx</span> <span class="o">=</span> <span class="n">GetOperandValue</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="s2">&quot;xor&quot;</span><span class="p">:</span>
        <span class="n">eax</span> <span class="o">^=</span> <span class="n">ebx</span>
    <span class="k">elif</span> <span class="n">flag</span> <span class="o">==</span> <span class="s2">&quot;shl&quot;</span><span class="p">:</span>
        <span class="n">eax</span> <span class="o">&lt;&lt;=</span> <span class="n">ebx</span>
    <span class="k">elif</span> <span class="n">flag</span> <span class="o">==</span> <span class="s2">&quot;sub&quot;</span><span class="p">:</span>
        <span class="n">eax</span> <span class="o">-=</span> <span class="n">ebx</span>
    <span class="k">elif</span> <span class="n">flag</span> <span class="o">==</span> <span class="s2">&quot;add&quot;</span><span class="p">:</span>
        <span class="n">eax</span> <span class="o">+=</span> <span class="n">ebx</span>
    <span class="k">elif</span> <span class="n">flag</span> <span class="o">==</span> <span class="s2">&quot;and&quot;</span><span class="p">:</span>
        <span class="n">eax</span> <span class="o">&amp;=</span> <span class="n">ebx</span>
    <span class="k">elif</span> <span class="n">flag</span> <span class="o">==</span> <span class="s2">&quot;shr&quot;</span><span class="p">:</span>
        <span class="n">eax</span> <span class="o">&gt;&gt;=</span> <span class="n">ebx</span>
    <span class="k">elif</span> <span class="n">flag</span> <span class="o">==</span> <span class="s2">&quot;or&quot;</span><span class="p">:</span>
        <span class="n">eax</span> <span class="o">|=</span> <span class="n">ebx</span>

    <span class="k">return</span> <span class="n">eax</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span>

<span class="n">OperandValue</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;or&#39;</span><span class="p">,</span><span class="s1">&#39;shr&#39;</span><span class="p">,</span><span class="s1">&#39;and&#39;</span><span class="p">,</span><span class="s1">&#39;add&#39;</span><span class="p">,</span><span class="s1">&#39;sub&#39;</span><span class="p">,</span><span class="s1">&#39;shl&#39;</span><span class="p">,</span><span class="s1">&#39;xor&#39;</span><span class="p">]</span>
<span class="n">Register</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ebx&#39;</span><span class="p">,</span><span class="s1">&#39;ecx&#39;</span><span class="p">,</span><span class="s1">&#39;edx&#39;</span><span class="p">,</span><span class="s1">&#39;eax&#39;</span><span class="p">]</span>
<span class="n">Patch_jnz</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;xor&#39;</span><span class="p">,</span><span class="s1">&#39;sub&#39;</span><span class="p">]</span>

<span class="n">dest_addr</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">_addr</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">addr</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
    <span class="nb">next</span> <span class="o">=</span> <span class="n">next_instr</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
    <span class="n">MakeCode</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">GetMnem</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="ow">in</span> <span class="n">Patch_jnz</span> <span class="ow">and</span> <span class="s1">&#39;jnz&#39;</span> <span class="ow">in</span> <span class="n">GetMnem</span><span class="p">(</span><span class="nb">next</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">GetOperandValue</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">GetOperandValue</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;sucess_patch_jnz: </span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">addr</span><span class="p">)</span>
            <span class="n">dest_addr</span> <span class="o">=</span> <span class="n">next_instr</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
            <span class="n">patch_nop</span><span class="p">(</span><span class="nb">next</span><span class="p">,</span> <span class="n">dest_addr</span><span class="p">)</span>


    <span class="k">if</span> <span class="s2">&quot;call    $+5&quot;</span> <span class="o">==</span> <span class="n">GetDisasm</span><span class="p">(</span><span class="n">addr</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;pop     eax&quot;</span> <span class="o">==</span> <span class="n">GetDisasm</span><span class="p">(</span><span class="nb">next</span><span class="p">):</span>
            <span class="n">dest_addr</span> <span class="o">=</span> <span class="n">addr</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">dest_addr</span> <span class="o">=</span> <span class="n">next_instr</span><span class="p">(</span><span class="n">dest_addr</span><span class="p">)</span>
                <span class="n">MakeCode</span><span class="p">(</span><span class="n">dest_addr</span><span class="p">)</span> 
            <span class="k">if</span> <span class="s2">&quot;jmp&quot;</span> <span class="ow">in</span> <span class="n">GetMnem</span><span class="p">(</span><span class="n">dest_addr</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;sucess_patch_call: </span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">addr</span><span class="p">)</span>
                <span class="n">patch_nop</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">dest_addr</span><span class="p">)</span>
                <span class="n">PatchByte</span><span class="p">(</span><span class="n">dest_addr</span><span class="p">,</span> <span class="mh">0xE8</span><span class="p">)</span>


    <span class="k">if</span> <span class="s2">&quot;xchg&quot;</span> <span class="ow">in</span> <span class="n">GetMnem</span><span class="p">(</span><span class="n">addr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">GetOperandValue</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">GetOperandValue</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;sucess_patch_xchg: </span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">addr</span><span class="p">)</span>
            <span class="n">patch_nop</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="nb">next</span><span class="p">)</span>


    <span class="k">if</span> <span class="s2">&quot;jmp     $+5&quot;</span> <span class="o">==</span> <span class="n">GetDisasm</span><span class="p">(</span><span class="n">addr</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;leave&quot;</span> <span class="ow">in</span> <span class="n">GetMnem</span><span class="p">(</span><span class="nb">next</span><span class="p">):</span>
            <span class="n">patch_nop</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="nb">next</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;sucess_patch_jmp: </span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">addr</span><span class="p">)</span>
            <span class="nb">next</span> <span class="o">=</span> <span class="n">next_instr</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
            <span class="n">addr</span> <span class="o">=</span> <span class="nb">next</span>
            <span class="nb">next</span> <span class="o">=</span> <span class="n">next_instr</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
            <span class="nb">next</span> <span class="o">=</span> <span class="n">next_instr</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
            <span class="n">patch_nop</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="nb">next</span><span class="p">)</span>
            <span class="n">PatchByte</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="mh">0xC3</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;[ebp&quot;</span> <span class="ow">in</span> <span class="n">GetDisasm</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">GetOperandValue</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mh">0x10000</span> <span class="ow">and</span> <span class="n">GetOperandValue</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mh">0xFFFFFFFF</span> <span class="o">-</span> <span class="mh">0x10000</span><span class="p">):</span>
        <span class="n">patch_nop</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="nb">next</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;sucess_patch_ebp: </span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">addr</span><span class="p">)</span>

    <span class="k">if</span> <span class="mh">0x0001329C</span> <span class="o">&gt;=</span> <span class="n">GetOperandValue</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mh">0x00013280</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;sucess: </span><span class="si">%x</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">addr</span><span class="p">)</span>
        <span class="n">eax</span> <span class="o">=</span> <span class="n">Dword</span><span class="p">(</span><span class="n">GetOperandValue</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>   
        <span class="n">_addr</span> <span class="o">=</span> <span class="n">addr</span>
        <span class="n">Reg</span> <span class="o">=</span> <span class="n">GetOperandValue</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">GetMnem</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span> <span class="ow">in</span> <span class="n">OperandValue</span><span class="p">:</span>
            <span class="n">eax</span> <span class="o">=</span> <span class="n">patch_global</span><span class="p">(</span><span class="nb">next</span><span class="p">,</span> <span class="n">eax</span><span class="p">)</span>
            <span class="n">_addr</span> <span class="o">=</span> <span class="nb">next</span>
            <span class="nb">next</span> <span class="o">=</span> <span class="n">next_instr</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
            <span class="n">MakeCode</span><span class="p">(</span><span class="n">_addr</span><span class="p">)</span>
            <span class="n">MakeCode</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">GetOperandValue</span><span class="p">(</span><span class="n">_addr</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">GetOperandValue</span><span class="p">(</span><span class="nb">next</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">GetOpnd</span><span class="p">(</span><span class="nb">next</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">Register</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">GetOpnd</span><span class="p">(</span><span class="n">_addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">GetOpnd</span><span class="p">(</span><span class="n">_addr</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">Reg</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">Reg</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">addr</span> <span class="o">=</span> <span class="n">next_instr</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
            <span class="n">patch_nop</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="nb">next</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Reg</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">PatchByte</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="mh">0xBB</span><span class="p">)</span>
            <span class="n">PatchDword</span><span class="p">(</span><span class="n">addr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span><span class="n">eax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Reg</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">PatchByte</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="mh">0xBA</span><span class="p">)</span>
            <span class="n">PatchDword</span><span class="p">(</span><span class="n">addr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span><span class="n">eax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Reg</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">PatchByte</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="mh">0xB9</span><span class="p">)</span>
            <span class="n">PatchDword</span><span class="p">(</span><span class="n">addr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span><span class="n">eax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Reg</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">PatchByte</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span><span class="mh">0xB8</span><span class="p">)</span>
            <span class="n">PatchDword</span><span class="p">(</span><span class="n">addr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span><span class="n">eax</span><span class="p">)</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="n">next_instr</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
    <span class="n">MakeCode</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>之后就可以F5，但是由于IDA是软件分析，所以那些函数得一个个F5.....</p>
<p>之后再手动去掉冗余代码，就可以很愉快的分析了：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>  <span class="n">printf</span><span class="p">(</span><span class="n">format</span><span class="p">);</span>
  <span class="n">_isoc99_scanf</span><span class="p">(</span><span class="n">a255s</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
  <span class="n">v8</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v8</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
    <span class="o">*</span><span class="n">v7</span> <span class="o">=</span> <span class="p">(</span><span class="n">input</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="mi">16</span> <span class="o">*</span> <span class="p">(</span><span class="n">input</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">);</span>
  <span class="n">v9</span><span class="p">[</span><span class="n">v8</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">sub_39C7</span><span class="p">(</span><span class="n">v9</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">sub_4638</span><span class="p">()</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x1Cu</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">v3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">v5</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">v4</span> <span class="o">=</span> <span class="n">mul_cube</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
        <span class="n">v3</span> <span class="o">+=</span> <span class="n">v4</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">v5</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
      <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">s</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v3</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="n">aHereIsYourFlag</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">puts</span><span class="p">(</span><span class="n">aTryAgain</span><span class="p">)</span> <span class="o">|</span> <span class="n">v0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="_2">算法</h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span> <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v8</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
    <span class="o">*</span><span class="n">v7</span> <span class="o">=</span> <span class="p">(</span><span class="n">input</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="mi">16</span> <span class="o">*</span> <span class="p">(</span><span class="n">input</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>这个循环将输入每两位一组转成十六进制数：例如输入1234会转成0x12,0x34</p>
<p>主要操作为<code>sub_39C7(v9);</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">sub_39C7</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// ecx</span>
  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [esp+54h] [ebp-8h]</span>
  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [esp+58h] [ebp-4h]</span>

  <span class="n">v4</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v4</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="k">switch</span> <span class="p">(</span> <span class="n">v1</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">case</span> <span class="mh">0x10</span><span class="o">:</span>
        <span class="n">sub_6D47</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x15</span><span class="o">:</span>
        <span class="n">sub_76DF</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x11</span><span class="o">:</span>
        <span class="n">sub_818A</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x14</span><span class="o">:</span>
        <span class="n">sub_88B8</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x12</span><span class="o">:</span>
        <span class="n">sub_9131</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x13</span><span class="o">:</span>
        <span class="n">sub_9BE7</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x20</span><span class="o">:</span>
        <span class="n">sub_A570</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x25</span><span class="o">:</span>
        <span class="n">sub_AC8E</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x21</span><span class="o">:</span>
        <span class="n">sub_B43B</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x24</span><span class="o">:</span>
        <span class="n">sub_BC72</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x22</span><span class="o">:</span>
        <span class="n">sub_C2E1</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x23</span><span class="o">:</span>
        <span class="n">sub_C9C9</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x30</span><span class="o">:</span>
        <span class="n">sub_D14D</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x35</span><span class="o">:</span>
        <span class="n">sub_DB6D</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x31</span><span class="o">:</span>
        <span class="n">sub_E5D7</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x34</span><span class="o">:</span>
        <span class="n">sub_EE9E</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x32</span><span class="o">:</span>
        <span class="n">sub_F7F9</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="mh">0x33</span><span class="o">:</span>
        <span class="n">sub_101AD</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">default</span><span class="o">:</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>根据case可以知道我们输入的范围：<code>10~15，20~25，30~35</code></p>
<p>随便进去一个看一下(这里也有一些冗余代码我手动去掉了，，便于分析)：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">sub_6D47</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [esp+5Ch] [ebp-8h]</span>
  <span class="kt">int</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// [esp+60h] [ebp-4h]</span>

  <span class="n">v2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
    <span class="n">F</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
    <span class="n">B</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
    <span class="n">E</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">v2</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">sub_5C20</span><span class="p">(</span><span class="n">D</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>应该是个轮换。</p>
<p>再根据经验不难推出，这应该是一个3阶魔方：<code>一共6个面，每个面有9个元素，共有3*6=18种操作</code></p>
<p>判断函数sub_4638():</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">sub_4638</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v0</span><span class="p">)[</span><span class="mi">9</span><span class="p">];</span> <span class="c1">// ST00_4</span>
  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [esp+4h] [ebp-8h]</span>
  <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [esp+8h] [ebp-4h]</span>

  <span class="n">v3</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span> <span class="o">&amp;&amp;</span> <span class="n">v3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="p">((</span><span class="o">*</span><span class="n">v0</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">v0</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">v0</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">v0</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">v0</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">cmp</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">((</span><span class="o">*</span><span class="n">v0</span><span class="p">)[</span><span class="mi">8</span><span class="p">]</span><span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">v0</span><span class="p">)[</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">v0</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">v0</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">v0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">cmp</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">v3</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">v3</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>可以分析出，该判断为每个魔方的：</p>
<p>sum(center + middle)==cmp[2 * i]</p>
<p>sum(center + coner)==cmp[2 * i + 1]</p>
<p>而得到flag的循环：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">v3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">v5</span> <span class="o">=</span> <span class="n">cube</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">v4</span> <span class="o">=</span> <span class="n">mul_cube</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="k">for</span> <span class="p">(</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span> <span class="p">)</span>
        <span class="n">v3</span> <span class="o">+=</span> <span class="n">v4</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">v5</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
      <span class="o">*</span><span class="p">(</span><span class="n">_DWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">s</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v3</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="n">aHereIsYourFlag</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="_3">穷举求解</h3>
<p>由上述分析，由于corner[4*6],middle[4*6],center[6],数据量小，可以通过穷举的方法求解：</p>
<h4 id="_4">提取</h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">mul_cube</span> <span class="o">=</span> <span class="p">[[</span><span class="mh">0xB849CD19</span><span class="p">,</span><span class="mh">0x55E00017</span><span class="p">,</span><span class="mh">0x844966B</span><span class="p">,</span><span class="mh">0x80C181EC</span><span class="p">,</span><span class="mh">0x686C0B3C</span><span class="p">,</span><span class="mh">0x55400592</span><span class="p">,</span><span class="mh">0xCD42168A</span><span class="p">,</span><span class="mh">0x4039E81</span><span class="p">,</span><span class="mh">0xD9DE549F</span><span class="p">],</span>
<span class="p">[</span><span class="mh">0x2034677D</span><span class="p">,</span><span class="mh">0x144ABD</span><span class="p">,</span><span class="mh">0x49100D00</span><span class="p">,</span><span class="mh">0xE003A0E0</span><span class="p">,</span><span class="mh">0x80F0006D</span><span class="p">,</span><span class="mh">0x8307ADD6</span><span class="p">,</span><span class="mh">0x4CF60781</span><span class="p">,</span><span class="mh">0xA0352643</span><span class="p">,</span><span class="mh">0xC580C3DE</span><span class="p">],</span>
<span class="p">[</span><span class="mh">0xEA8C4E24</span><span class="p">,</span><span class="mh">0x68603008</span><span class="p">,</span><span class="mh">0x687FBFFF</span><span class="p">,</span><span class="mh">0x19DE4BF9</span><span class="p">,</span><span class="mh">0x271A1179</span><span class="p">,</span><span class="mh">0x99791C4D</span><span class="p">,</span><span class="mh">0x29CBFFC</span><span class="p">,</span><span class="mh">0x2B82801E</span><span class="p">,</span><span class="mh">0x3C0307FB</span><span class="p">],</span>
<span class="p">[</span><span class="mh">0xDAE61CD6</span><span class="p">,</span><span class="mh">0x8F7B1BF0</span><span class="p">,</span><span class="mh">0xC56CEF1D</span><span class="p">,</span><span class="mh">0xD6493A96</span><span class="p">,</span><span class="mh">0x1808018</span><span class="p">,</span><span class="mh">0xF48001B9</span><span class="p">,</span><span class="mh">0x3712519</span><span class="p">,</span><span class="mh">0x9294F318</span><span class="p">,</span><span class="mh">0x6DE20384</span><span class="p">],</span>
<span class="p">[</span><span class="mh">0xF3750B04</span><span class="p">,</span><span class="mh">0x256A122A</span><span class="p">,</span><span class="mh">0x257290B</span><span class="p">,</span><span class="mh">0xC4582056</span><span class="p">,</span><span class="mh">0x204E8BC0</span><span class="p">,</span><span class="mh">0x79C7ADE7</span><span class="p">,</span><span class="mh">0xC4C20203</span><span class="p">,</span><span class="mh">0x5B961570</span><span class="p">,</span><span class="mh">0x66034856</span><span class="p">],</span>
<span class="p">[</span><span class="mh">0x78329E3A</span><span class="p">,</span><span class="mh">0x1D07C00</span><span class="p">,</span><span class="mh">0x4AC240E6</span><span class="p">,</span><span class="mh">0x854CFBBE</span><span class="p">,</span><span class="mh">0xABFEC404</span><span class="p">,</span><span class="mh">0x5BD80037</span><span class="p">,</span><span class="mh">0xE94CBCD8</span><span class="p">,</span><span class="mh">0x1</span><span class="p">,</span><span class="mh">0xC4CA280D</span><span class="p">]]</span>

<span class="n">cube</span> <span class="o">=</span>  <span class="p">[[</span><span class="mh">0xFDFE0BA1</span><span class="p">,</span><span class="mh">0x9A915052</span><span class="p">,</span><span class="mh">0xC96F3527</span><span class="p">,</span><span class="mh">0xF5201FCD</span><span class="p">,</span><span class="mh">0xFE32ED8F</span><span class="p">,</span><span class="mh">0xDB8E3EF9</span><span class="p">,</span><span class="mh">0x51EF954</span><span class="p">,</span><span class="mh">0xFE217F1C</span><span class="p">,</span><span class="mh">0x7B33A8BB</span><span class="p">],</span>
<span class="p">[</span><span class="mh">0x9CF903A1</span><span class="p">,</span><span class="mh">0xC381E2CD</span><span class="p">,</span><span class="mh">0x22B35BE4</span><span class="p">,</span><span class="mh">0x4550E6AE</span><span class="p">,</span><span class="mh">0xDC9E8F3C</span><span class="p">,</span><span class="mh">0xA9B44EAF</span><span class="p">,</span><span class="mh">0x3372486A</span><span class="p">,</span><span class="mh">0x51329F58</span><span class="p">,</span><span class="mh">0x5F2F456E</span><span class="p">],</span>
<span class="p">[</span><span class="mh">0x9B555A08</span><span class="p">,</span><span class="mh">0xEB1A8529</span><span class="p">,</span><span class="mh">0x9B009084</span><span class="p">,</span><span class="mh">0x9B0B7B06</span><span class="p">,</span><span class="mh">0x9967F311</span><span class="p">,</span><span class="mh">0x91FB13AB</span><span class="p">,</span><span class="mh">0x18952236</span><span class="p">,</span><span class="mh">0x6F7B9915</span><span class="p">,</span><span class="mh">0xEDD9D6D1</span><span class="p">],</span>
<span class="p">[</span><span class="mh">0xFB67FE21</span><span class="p">,</span><span class="mh">0x259911B0</span><span class="p">,</span><span class="mh">0x3DC4EE74</span><span class="p">,</span><span class="mh">0x98936FF0</span><span class="p">,</span><span class="mh">0xDF7502CE</span><span class="p">,</span><span class="mh">0xC3DF1016</span><span class="p">,</span><span class="mh">0xBC1220F9</span><span class="p">,</span><span class="mh">0xF54C810C</span><span class="p">,</span><span class="mh">0x715A634C</span><span class="p">],</span>
<span class="p">[</span><span class="mh">0x3E1637A6</span><span class="p">,</span><span class="mh">0x80F07B8D</span><span class="p">,</span><span class="mh">0xFB9CA491</span><span class="p">,</span><span class="mh">0xAD254C2E</span><span class="p">,</span><span class="mh">0xFB5A012F</span><span class="p">,</span><span class="mh">0x1AEF5581</span><span class="p">,</span><span class="mh">0xB9CC1351</span><span class="p">,</span><span class="mh">0x9A3B536D</span><span class="p">,</span><span class="mh">0xBD7FAF0F</span><span class="p">],</span>
<span class="p">[</span><span class="mh">0xF49AD883</span><span class="p">,</span><span class="mh">0x2C55324</span><span class="p">,</span><span class="mh">0x83BC3205</span><span class="p">,</span><span class="mh">0x43846281</span><span class="p">,</span><span class="mh">0x19382448</span><span class="p">,</span><span class="mh">0xFADB2B18</span><span class="p">,</span><span class="mh">0x9335D185</span><span class="p">,</span><span class="mh">0x94C6BF5A</span><span class="p">,</span><span class="mh">0x591685AE</span><span class="p">]]</span>

<span class="k">print</span><span class="p">(</span><span class="n">center</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">mul_cube</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span> <span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">corner</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="n">mul_cube</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">v0</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span><span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">middle</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="n">mul_cube</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">v0</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h4 id="_5">组合求值</h4>
<p>用cmp来center的确定值以及对应corner，middle的取值</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>
<span class="n">corner</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0xfdfe0ba1</span><span class="p">,</span><span class="mh">0xc96f3527</span><span class="p">,</span><span class="mh">0x51ef954</span><span class="p">,</span><span class="mh">0x7b33a8bb</span><span class="p">,</span><span class="mh">0x9cf903a1</span><span class="p">,</span><span class="mh">0x22b35be4</span><span class="p">,</span><span class="mh">0x3372486a</span><span class="p">,</span><span class="mh">0x5f2f456e</span><span class="p">,</span><span class="mh">0x9b555a08</span><span class="p">,</span><span class="mh">0x9b009084</span><span class="p">,</span><span class="mh">0x18952236</span><span class="p">,</span><span class="mh">0xedd9d6d1</span><span class="p">,</span><span class="mh">0xfb67fe21</span><span class="p">,</span><span class="mh">0x3dc4ee74</span><span class="p">,</span><span class="mh">0xbc1220f9</span><span class="p">,</span><span class="mh">0x715a634c</span><span class="p">,</span><span class="mh">0x3e1637a6</span><span class="p">,</span><span class="mh">0xfb9ca491</span><span class="p">,</span><span class="mh">0xb9cc1351</span><span class="p">,</span><span class="mh">0xbd7faf0f</span><span class="p">,</span><span class="mh">0xf49ad883</span><span class="p">,</span><span class="mh">0x83bc3205</span><span class="p">,</span><span class="mh">0x9335d185</span><span class="p">,</span><span class="mh">0x591685ae</span><span class="p">]</span>

<span class="n">middle</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x9a915052</span><span class="p">,</span><span class="mh">0xf5201fcd</span><span class="p">,</span><span class="mh">0xdb8e3ef9</span><span class="p">,</span><span class="mh">0xfe217f1c</span><span class="p">,</span><span class="mh">0xc381e2cd</span><span class="p">,</span><span class="mh">0x4550e6ae</span><span class="p">,</span><span class="mh">0xa9b44eaf</span><span class="p">,</span><span class="mh">0x51329f58</span><span class="p">,</span><span class="mh">0xeb1a8529</span><span class="p">,</span><span class="mh">0x9b0b7b06</span><span class="p">,</span><span class="mh">0x91fb13ab</span><span class="p">,</span><span class="mh">0x6f7b9915</span><span class="p">,</span><span class="mh">0x259911b0</span><span class="p">,</span><span class="mh">0x98936ff0</span><span class="p">,</span><span class="mh">0xc3df1016</span><span class="p">,</span><span class="mh">0xf54c810c</span><span class="p">,</span><span class="mh">0x80f07b8d</span><span class="p">,</span><span class="mh">0xad254c2e</span><span class="p">,</span><span class="mh">0x1aef5581</span><span class="p">,</span><span class="mh">0x9a3b536d</span><span class="p">,</span><span class="mh">0x2c55324</span><span class="p">,</span><span class="mh">0x43846281</span><span class="p">,</span><span class="mh">0xfadb2b18</span><span class="p">,</span><span class="mh">0x94c6bf5a</span><span class="p">]</span>

<span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0xfe32ed8f</span><span class="p">,</span><span class="mh">0xdc9e8f3c</span><span class="p">,</span><span class="mh">0x9967f311</span><span class="p">,</span><span class="mh">0xdf7502ce</span><span class="p">,</span><span class="mh">0xfb5a012f</span><span class="p">,</span><span class="mh">0x19382448</span><span class="p">]</span>

<span class="c1">#print(corner)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">corner_1</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">corner</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">corner_0</span> <span class="ow">in</span> <span class="n">corner_1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="n">corner_0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">corner_0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">corner_0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">corner_0</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="n">center</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="nb">sum</span> <span class="o">&amp;=</span> <span class="mh">0xFFFFFFFF</span>
            <span class="c1"># print(i)</span>
            <span class="k">if</span> <span class="nb">sum</span> <span class="o">==</span> <span class="nb">cmp</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]:</span>
                <span class="k">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">hex</span><span class="p">,</span> <span class="n">corner_0</span><span class="p">))))</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;----------------------------&quot;</span><span class="p">)</span>
<span class="c1"># print(middle)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">middle_1</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">middle</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">middle_0</span> <span class="ow">in</span> <span class="n">middle_1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="n">middle_0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">middle_0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">middle_0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">middle_0</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="n">center</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="nb">sum</span> <span class="o">&amp;=</span> <span class="mh">0xFFFFFFFF</span>
            <span class="c1"># print(i)</span>
            <span class="k">if</span> <span class="nb">sum</span> <span class="o">==</span> <span class="nb">cmp</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="k">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">hex</span><span class="p">,</span> <span class="n">middle_0</span><span class="p">))))</span>
</pre></div>
</td></tr></table>

<h4 id="_6">排列组合，穷举求解</h4>
<p>用可见字符进行过滤</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">center</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0xdf7502ce</span><span class="p">,</span> <span class="mh">0x9967f311</span><span class="p">,</span> <span class="mh">0xdc9e8f3c</span><span class="p">,</span>
          <span class="mh">0xfe32ed8f</span><span class="p">,</span> <span class="mh">0x19382448</span><span class="p">,</span> <span class="mh">0xfb5a012f</span><span class="p">]</span>
<span class="n">corner</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mh">0xfdfe0ba1</span><span class="p">,</span> <span class="mh">0x7b33a8bb</span><span class="p">,</span> <span class="mh">0x3dc4ee74</span><span class="p">,</span> <span class="mh">0x3e1637a6</span><span class="p">],</span> <span class="p">[</span><span class="mh">0xc96f3527</span><span class="p">,</span> <span class="mh">0x51ef954</span><span class="p">,</span> <span class="mh">0x715a634c</span><span class="p">,</span> <span class="mh">0x9335d185</span><span class="p">],</span> <span class="p">[</span><span class="mh">0x9b009084</span><span class="p">,</span> <span class="mh">0x18952236</span><span class="p">,</span> <span class="mh">0xbd7faf0f</span><span class="p">,</span> <span class="mh">0x83bc3205</span><span class="p">],</span> <span class="p">[</span><span class="mh">0x22b35be4</span><span class="p">,</span> <span class="mh">0x3372486a</span><span class="p">,</span> <span class="mh">0xedd9d6d1</span><span class="p">,</span> <span class="mh">0xfb9ca491</span><span class="p">],</span> <span class="p">[</span><span class="mh">0x9cf903a1</span><span class="p">,</span> <span class="mh">0x9b555a08</span><span class="p">,</span> <span class="mh">0xb9cc1351</span><span class="p">,</span> <span class="mh">0x591685ae</span><span class="p">],</span> <span class="p">[</span><span class="mh">0x5f2f456e</span><span class="p">,</span> <span class="mh">0xfb67fe21</span><span class="p">,</span> <span class="mh">0xbc1220f9</span><span class="p">,</span> <span class="mh">0xf49ad883</span><span class="p">]]</span>

<span class="n">middle</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mh">0x51329f58</span><span class="p">,</span> <span class="mh">0x6f7b9915</span><span class="p">,</span> <span class="mh">0x2c55324</span><span class="p">,</span> <span class="mh">0x43846281</span><span class="p">],</span> <span class="p">[</span><span class="mh">0xf5201fcd</span><span class="p">,</span> <span class="mh">0xdb8e3ef9</span><span class="p">,</span> <span class="mh">0xeb1a8529</span><span class="p">,</span> <span class="mh">0x9a3b536d</span><span class="p">],</span> <span class="p">[</span><span class="mh">0xc381e2cd</span><span class="p">,</span> <span class="mh">0x98936ff0</span><span class="p">,</span> <span class="mh">0xc3df1016</span><span class="p">,</span> <span class="mh">0x94c6bf5a</span><span class="p">],</span> <span class="p">[</span><span class="mh">0x91fb13ab</span><span class="p">,</span> <span class="mh">0x80f07b8d</span><span class="p">,</span> <span class="mh">0xad254c2e</span><span class="p">,</span> <span class="mh">0x1aef5581</span><span class="p">],</span> <span class="p">[</span><span class="mh">0xfe217f1c</span><span class="p">,</span> <span class="mh">0xa9b44eaf</span><span class="p">,</span> <span class="mh">0x259911b0</span><span class="p">,</span> <span class="mh">0xf54c810c</span><span class="p">],</span> <span class="p">[</span><span class="mh">0x9a915052</span><span class="p">,</span> <span class="mh">0x4550e6ae</span><span class="p">,</span> <span class="mh">0x9b0b7b06</span><span class="p">,</span> <span class="mh">0xfadb2b18</span><span class="p">]]</span>

<span class="n">mul_center</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x686c0b3c</span><span class="p">,</span> <span class="mh">0x80f0006d</span><span class="p">,</span> <span class="mh">0x271a1179</span><span class="p">,</span> <span class="mh">0x1808018</span><span class="p">,</span> <span class="mh">0x204e8bc0</span><span class="p">,</span> <span class="mh">0xabfec404</span><span class="p">]</span>
<span class="n">mul_corner</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mh">0xb849cd19</span><span class="p">,</span> <span class="mh">0x844966b</span><span class="p">,</span> <span class="mh">0xcd42168a</span><span class="p">,</span> <span class="mh">0xd9de549f</span><span class="p">],</span> 
    <span class="p">[</span><span class="mh">0x2034677d</span><span class="p">,</span> <span class="mh">0x49100d00</span><span class="p">,</span> <span class="mh">0x4cf60781</span><span class="p">,</span> <span class="mh">0xc580c3de</span><span class="p">],</span> 
    <span class="p">[</span><span class="mh">0xea8c4e24</span><span class="p">,</span> <span class="mh">0x687fbfff</span><span class="p">,</span> <span class="mh">0x29cbffc</span><span class="p">,</span> <span class="mh">0x3c0307fb</span><span class="p">],</span> 
    <span class="p">[</span><span class="mh">0xdae61cd6</span><span class="p">,</span> <span class="mh">0xc56cef1d</span><span class="p">,</span> <span class="mh">0x3712519</span><span class="p">,</span> <span class="mh">0x6de20384</span><span class="p">],</span> 
    <span class="p">[</span><span class="mh">0xf3750b04</span><span class="p">,</span>   <span class="mh">0x257290b</span><span class="p">,</span> <span class="mh">0xc4c20203</span><span class="p">,</span> <span class="mh">0x66034856</span><span class="p">],</span> 
    <span class="p">[</span><span class="mh">0x78329e3a</span><span class="p">,</span> <span class="mh">0x4ac240e6</span><span class="p">,</span> <span class="mh">0xe94cbcd8</span><span class="p">,</span> <span class="mh">0xc4ca280d</span><span class="p">]]</span>
<span class="n">mul_middle</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mh">0x55e00017</span><span class="p">,</span> <span class="mh">0x80c181ec</span><span class="p">,</span> <span class="mh">0x55400592</span><span class="p">,</span> <span class="mh">0x4039e81</span><span class="p">],</span> 
    <span class="p">[</span><span class="mh">0x144abd</span><span class="p">,</span> <span class="mh">0xe003a0e0</span><span class="p">,</span> <span class="mh">0x8307add6</span><span class="p">,</span> <span class="mh">0xa0352643</span><span class="p">],</span> 
    <span class="p">[</span><span class="mh">0x68603008</span><span class="p">,</span> <span class="mh">0x19de4bf9</span><span class="p">,</span> <span class="mh">0x99791c4d</span><span class="p">,</span> <span class="mh">0x2b82801e</span><span class="p">],</span> 
    <span class="p">[</span><span class="mh">0x8f7b1bf0</span><span class="p">,</span> <span class="mh">0xd6493a96</span><span class="p">,</span> <span class="mh">0xf48001b9</span><span class="p">,</span> <span class="mh">0x9294f318</span><span class="p">],</span> 
    <span class="p">[</span><span class="mh">0x256a122a</span><span class="p">,</span> <span class="mh">0xc4582056</span><span class="p">,</span> <span class="mh">0x79c7ade7</span><span class="p">,</span> <span class="mh">0x5b961570</span><span class="p">],</span> 
    <span class="p">[</span><span class="mh">0x1d07c00</span><span class="p">,</span> <span class="mh">0x854cfbbe</span><span class="p">,</span> <span class="mh">0x5bd80037</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;-------------------&quot;</span><span class="p">)</span>
    <span class="n">corner_0</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="n">corner</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">middle_0</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="n">middle</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">):</span>
        <span class="n">corner_1</span> <span class="o">=</span> <span class="n">corner_0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">):</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="n">center</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">mul_center</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">middle_1</span> <span class="o">=</span> <span class="n">middle_0</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="c1"># print(list(map(hex, middle_1)))</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="n">corner_1</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="n">mul_corner</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="n">middle_1</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">*</span> <span class="n">mul_middle</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
            <span class="n">key</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">char</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
                <span class="k">if</span> <span class="mh">0x30</span> <span class="o">&lt;=</span> <span class="n">char</span> <span class="o">&lt;=</span> <span class="mh">0x39</span> <span class="ow">or</span> <span class="mh">0x41</span> <span class="o">&lt;=</span> <span class="n">char</span> <span class="o">&lt;=</span> <span class="mh">0x41</span> <span class="o">+</span> <span class="mi">25</span> <span class="ow">or</span> <span class="mh">0x61</span> <span class="o">&lt;=</span> <span class="n">char</span> <span class="o">&lt;=</span> <span class="mh">0x61</span> <span class="o">+</span> <span class="mi">25</span> <span class="ow">or</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">char</span> <span class="ow">or</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">char</span> <span class="ow">or</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">char</span> <span class="ow">or</span> <span class="nb">ord</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">char</span><span class="p">:</span>
                    <span class="n">flag</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">sum</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span>
                    <span class="nb">sum</span> <span class="o">&gt;&gt;=</span> <span class="mi">8</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>得到:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>-------------------
*CTF
erkU
-------------------
Gj3o
{7h1
KP6o
uk6W
4gjL
-------------------
S_Cu
oeps
-------------------
63_i
ERNJ
-------------------
s_m4
-------------------
ukxG
uHnr
g1c}
4nEE
YOcm
AkT6
YctL
VRae
</pre></div>
</td></tr></table>

<p>根据词义不难猜出flag为：</p>
<p>*CTF{7h1S<em>Cu63</em>is_m4g1c}</p>
<h2 id="obfuscating-macros-ii">Obfuscating Macros II</h2>
<p>题目：<a href="https://raw.githubusercontent.com/Alikas0/CTF/master/challenges/StarCTF-2019/Obfuscating Macros II.zip">Obfuscating Macros II</a></p>
<p>根据题目混淆宏emmmmmm不懂</p>
<p>运行下程序</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>./obfuscating_macros_II.out
sss
Failed
</pre></div>
</td></tr></table>

<p>IDA打开找到main函数：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">v21</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">basic_string</span><span class="p">();</span>
  <span class="n">v16</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="n">v17</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">operator</span><span class="o">&gt;&gt;&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v20</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">length</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="o">!=</span> <span class="mi">16</span> <span class="p">)</span>
    <span class="k">goto</span> <span class="n">LABEL_9</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">c_str</span><span class="p">();</span>
  <span class="n">v5</span> <span class="o">=</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::</span><span class="n">c_str</span><span class="p">();</span>
  <span class="n">encrypto</span><span class="p">(</span><span class="n">v5</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">v6</span> <span class="o">+</span> <span class="mi">8</span><span class="p">));</span>
  <span class="n">v18</span> <span class="o">=</span> <span class="n">v7</span><span class="p">;</span>
  <span class="n">v19</span> <span class="o">=</span> <span class="n">v8</span><span class="p">;</span>
  <span class="n">sub_40465C</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v16</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v18</span><span class="p">);</span>
  <span class="n">v9</span> <span class="o">=</span> <span class="n">v17</span><span class="p">;</span>
  <span class="n">v10</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="n">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="n">v16</span><span class="p">);</span>
  <span class="n">v11</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">v10</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="o">&amp;</span><span class="n">byte_407D38</span><span class="p">);</span>
  <span class="n">v12</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="n">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v11</span><span class="p">,</span> <span class="n">v9</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="n">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v12</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v16</span> <span class="o">!=</span> <span class="mh">0xA1E8895EB916B732LL</span> <span class="o">||</span> <span class="n">v17</span> <span class="o">!=</span> <span class="mh">0x50A2DCC51ED6C4A2LL</span> <span class="p">)</span>
  <span class="p">{</span>
<span class="nl">LABEL_9</span><span class="p">:</span>
    <span class="n">v14</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">((</span><span class="kr">__int64</span><span class="p">)</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="s">&quot;Failed&quot;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="n">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v14</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">v13</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">((</span><span class="kr">__int64</span><span class="p">)</span><span class="o">&amp;</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="s">&quot;Congratulations!&quot;</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ostream</span><span class="o">::</span><span class="n">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">v13</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">std</span><span class="o">::</span><span class="n">__cxx11</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&gt;::~</span><span class="n">basic_string</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v20</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0LL</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<h3 id="_7">程序流程</h3>
<p>根据调试:</p>
<p>首先判断输出长度是否为16：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="n">v3</span> <span class="o">!=</span> <span class="mi">16</span> <span class="p">)</span>
    <span class="k">goto</span> <span class="n">LABEL_9</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>接着进入encrypto函数进行加密,加密后判断：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">if</span> <span class="p">(</span> <span class="n">v16</span> <span class="o">!=</span> <span class="mh">0xA1E8895EB916B732LL</span> <span class="o">||</span> <span class="n">v17</span> <span class="o">!=</span> <span class="mh">0x50A2DCC51ED6C4A2LL</span> <span class="p">)</span>
</pre></div>
</td></tr></table>

<p>重点就是在encrypto函数咯。</p>
<h3 id="_8">加密函数</h3>
<p>进去以后发现根本看不懂....调试大法好！</p>
<p>首先是将输入切成两段，长度为8：</p>
<p><img alt="" src="https://raw.githubusercontent.com/Alikas0/files/master/img/20190720160232.png" /></p>
<p>接着在栈里面看哪里对这两块地方进行了操作，这里我输入了11111111AAAAAAAA：</p>
<p>得到：</p>
<p>首先来到了v16 = 0,判断v16 &lt;= 0x3FF，那么回到这里就是一个循环咯：</p>
<p>接着第一段取反</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">v8</span> <span class="o">=</span> <span class="o">~</span><span class="n">v7</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>接着</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">v7</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>为真则</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">v8</span><span class="o">^=*</span><span class="n">v5</span>
</pre></div>
</td></tr></table>

<p>这里看到v8 指向了v6，v5 指向了v7</p>
<p>接下来就是</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">v6</span> <span class="o">=</span> <span class="n">v8</span>
<span class="n">v7</span> <span class="o">~=</span> <span class="n">v7</span>
</pre></div>
</td></tr></table>

<p>再接着根据调试不难发现,接下来就是对整一个128位字符进行循环左移1位.</p>
<p>因为一开始<code>if(v7&amp;1)</code>为真，这次我们输00000000AAAAAAAA：</p>
<p>得到<code>v8^=*v5</code>此时v5变成了指向~v7，而之后就都一样了。</p>
<p>不难写出加密算法:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">Andf</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">str</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFFFFFFFFF</span> 

<span class="k">def</span> <span class="nf">Rol</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span><span class="n">str2</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">str1</span> <span class="o">&gt;&gt;</span> <span class="mi">63</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">str2</span> <span class="o">&gt;&gt;</span> <span class="mi">63</span>
    <span class="n">str2</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
    <span class="n">str1</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
    <span class="n">str2</span> <span class="o">|=</span> <span class="n">a</span>
    <span class="n">str1</span> <span class="o">|=</span> <span class="n">b</span>
    <span class="n">str1</span><span class="p">,</span><span class="n">str2</span> <span class="o">=</span> <span class="n">Andf</span><span class="p">(</span><span class="n">str1</span><span class="p">),</span><span class="n">Andf</span><span class="p">(</span><span class="n">str2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">str1</span><span class="p">,</span><span class="n">str2</span>

<span class="k">def</span> <span class="nf">Encrypto</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span><span class="n">str2</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">str1</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">str2</span> <span class="o">^=</span> <span class="n">str1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">str2</span> <span class="o">^=</span> <span class="p">(</span><span class="o">~</span><span class="n">str1</span><span class="p">)</span>
    <span class="n">str1</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">str1</span><span class="p">)</span>
    <span class="n">str1</span> <span class="o">=</span> <span class="n">Andf</span><span class="p">(</span><span class="n">str1</span><span class="p">)</span>
    <span class="n">str2</span> <span class="o">=</span> <span class="n">Andf</span><span class="p">(</span><span class="n">str2</span><span class="p">)</span>
    <span class="n">str1</span><span class="p">,</span><span class="n">str2</span> <span class="o">=</span> <span class="n">Rol</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span><span class="n">str2</span><span class="p">)</span>   
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">str2</span>
    <span class="n">str2</span> <span class="o">+=</span> <span class="n">str1</span>
    <span class="n">str2</span> <span class="o">=</span> <span class="n">Andf</span><span class="p">(</span><span class="n">str2</span><span class="p">)</span>
    <span class="n">str1</span> <span class="o">=</span> <span class="n">tmp</span>
    <span class="n">str1</span><span class="p">,</span> <span class="n">str2</span> <span class="o">=</span> <span class="n">Rol</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">str1</span><span class="p">,</span><span class="n">str2</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x400</span><span class="p">):</span>
   <span class="n">str1</span><span class="p">,</span><span class="n">str2</span> <span class="o">=</span> <span class="n">Encrypto</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span><span class="n">str2</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>则解密脚本为：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">Andf</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">str</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFFFFFFFFF</span> 

<span class="k">def</span> <span class="nf">Ror</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span><span class="n">str2</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">str1</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">63</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">str2</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">63</span>
    <span class="n">str2</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
    <span class="n">str1</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
    <span class="n">str1</span> <span class="o">|=</span> <span class="n">b</span>
    <span class="n">str2</span> <span class="o">|=</span> <span class="n">a</span>
    <span class="n">str1</span><span class="p">,</span><span class="n">str2</span> <span class="o">=</span> <span class="n">Andf</span><span class="p">(</span><span class="n">str1</span><span class="p">),</span><span class="n">Andf</span><span class="p">(</span><span class="n">str2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">str1</span><span class="p">,</span><span class="n">str2</span>

<span class="k">def</span> <span class="nf">Decrypto</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span><span class="n">str2</span><span class="p">):</span>
    <span class="n">str1</span><span class="p">,</span> <span class="n">str2</span> <span class="o">=</span> <span class="n">Ror</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">str2</span>
    <span class="n">tmp</span> <span class="o">-=</span> <span class="n">str1</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">Andf</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="n">str2</span> <span class="o">=</span> <span class="n">str1</span>
    <span class="n">str1</span> <span class="o">=</span> <span class="n">tmp</span>
    <span class="n">str1</span><span class="p">,</span> <span class="n">str2</span> <span class="o">=</span> <span class="n">Ror</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span> <span class="n">str2</span><span class="p">)</span>
    <span class="n">str1</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">str1</span><span class="p">)</span>
    <span class="n">str1</span> <span class="o">=</span> <span class="n">Andf</span><span class="p">(</span><span class="n">str1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">str1</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">str2</span> <span class="o">^=</span> <span class="n">str1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">str2</span> <span class="o">^=</span> <span class="p">(</span><span class="o">~</span><span class="n">str1</span><span class="p">)</span>
    <span class="n">str2</span> <span class="o">=</span> <span class="n">Andf</span><span class="p">(</span><span class="n">str2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">str1</span><span class="p">,</span><span class="n">str2</span>

<span class="n">str1</span> <span class="o">=</span> <span class="mh">0xA1E8895EB916B732</span>
<span class="n">str2</span> <span class="o">=</span> <span class="mh">0x50A2DCC51ED6C4A2</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x400</span><span class="p">):</span>
   <span class="n">str1</span><span class="p">,</span><span class="n">str2</span> <span class="o">=</span> <span class="n">Decrypto</span><span class="p">(</span><span class="n">str1</span><span class="p">,</span><span class="n">str2</span><span class="p">)</span>

<span class="c1"># print(hex(str1),hex(str2))</span>

<span class="n">str1</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x6e</span><span class="p">,</span><span class="mh">0x55</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="mh">0x7b</span><span class="p">,</span><span class="mh">0x46</span><span class="p">,</span><span class="mh">0x54</span><span class="p">,</span><span class="mh">0x43</span><span class="p">,</span><span class="mh">0x2a</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">str2</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x7d</span><span class="p">,</span><span class="mh">0x39</span><span class="p">,</span><span class="mh">0x66</span><span class="p">,</span><span class="mh">0x43</span><span class="p">,</span><span class="mh">0x74</span><span class="p">,</span><span class="mh">0x40</span><span class="p">,</span><span class="mh">0x6c</span><span class="p">,</span><span class="mh">0x66</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">str</span> <span class="o">=</span> <span class="n">str1</span> <span class="o">+</span> <span class="n">str2</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span><span class="nb">str</span><span class="p">)))</span>
</pre></div>
</td></tr></table>

<p>得到flag：</p>
<p>*CTF{fUnfl@tCf9}</p>
<h3 id="_9">验证</h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>./obfuscating_macros_II.out
*CTF{fUnfl@tCf9}
11666725874628474674 5810449208445420706
Congratulations!
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../2019rctf/" title="2019 RCTF国际赛" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  上一页
                </span>
                2019 RCTF国际赛
              </span>
            </div>
          </a>
        
        
          <a href="../2019qwb/" title="2019 强网杯" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  下一页
                </span>
                2019 强网杯
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/Alikas0" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://t.me/Alikas" class="md-footer-social__link fa fa-telegram"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.245445c6.js"></script>
      
        
        
          
          <script src="../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="../../../js/extra.js"></script>
      
    
  </body>
</html>