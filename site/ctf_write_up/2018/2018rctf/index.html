



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://blog.alikas.cf/ctf_write_up/2018/2018rctf/">
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="https://raw.githubusercontent.com/Alikas0/files/master/videos/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>2018 RCTF - Alikas|station</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#0x00-magic" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://blog.alikas.cf" title="Alikas|station" class="md-header-nav__button md-logo">
          
            <i class="md-icon">border_color</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Alikas|station
            </span>
            <span class="md-header-nav__topic">
              
                2018 RCTF
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/Alikas0/Alikas0.github.io/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Alikas0.github.io
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://blog.alikas.cf" title="Alikas|station" class="md-nav__button md-logo">
      
        <i class="md-icon">border_color</i>
      
    </a>
    Alikas|station
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/Alikas0/Alikas0.github.io/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Alikas0.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Homepage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Homepage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../.." title="主页" class="md-nav__link">
      主页
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../links/" title="友情链接" class="md-nav__link">
      友情链接
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      CTF Write-Up
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        CTF Write-Up
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" checked>
    
    <label class="md-nav__link" for="nav-2-1">
      2018
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        2018
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        2018 RCTF
      </label>
    
    <a href="./" title="2018 RCTF" class="md-nav__link md-nav__link--active">
      2018 RCTF
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0x00-magic" title="0x00 magic" class="md-nav__link">
    0x00 magic
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rc4" title="RC4" class="md-nav__link">
    RC4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check" title="check" class="md-nav__link">
    check
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      2019
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        2019
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../2019/2019aurora/" title="2019 Aurora内部赛" class="md-nav__link">
      2019 Aurora内部赛
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2019/2019rctf/" title="2019 RCTF国际赛" class="md-nav__link">
      2019 RCTF国际赛
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2019/2019starctf/" title="2019 *CTF" class="md-nav__link">
      2019 *CTF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../2019/2019qwb/" title="2019 强网杯" class="md-nav__link">
      2019 强网杯
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Exams
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Exams
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3-1" type="checkbox" id="nav-2-3-1">
    
    <label class="md-nav__link" for="nav-2-3-1">
      BUUCTF
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-3-1">
        BUUCTF
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../exams/buuctf/introduction/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exams/buuctf/misc/" title="MISC" class="md-nav__link">
      MISC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exams/buuctf/reverse/" title="Reverse" class="md-nav__link">
      Reverse
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3-2" type="checkbox" id="nav-2-3-2">
    
    <label class="md-nav__link" for="nav-2-3-2">
      旧版Bugku
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-3-2">
        旧版Bugku
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../exams/old_bugku/introduction/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exams/old_bugku/reverse/" title="Reverse" class="md-nav__link">
      Reverse
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3-3" type="checkbox" id="nav-2-3-3">
    
    <label class="md-nav__link" for="nav-2-3-3">
      实验吧
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-3-3">
        实验吧
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../exams/shiyanba/introduction/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../exams/shiyanba/reverse/" title="Reverse" class="md-nav__link">
      Reverse
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      CTF Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        CTF Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ctf_tools/xortool/" title="Xortool" class="md-nav__link">
      Xortool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../ctf_tools/ida_python/" title="IDA python" class="md-nav__link">
      IDA python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      MISC
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        MISC
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/python_script/" title="python脚本" class="md-nav__link">
      python脚本
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/big_little_ending/" title="大端序和小端序" class="md-nav__link">
      大端序和小端序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      提问的智慧
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        提问的智慧
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/introduction/" title="简介" class="md-nav__link">
      简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/before_you_ask/" title="在提问之前" class="md-nav__link">
      在提问之前
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/when_you_ask/" title="当你在提问时" class="md-nav__link">
      当你在提问时
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/how_to_interpret_answers/" title="如何解读答案" class="md-nav__link">
      如何解读答案
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/on_not_reacting_like_loser/" title="如何避免扮演失败者" class="md-nav__link">
      如何避免扮演失败者
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/questions_not_to_ask/" title="不该问的问题" class="md-nav__link">
      不该问的问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/good_and_bad_questions/" title="好问题与蠢问题" class="md-nav__link">
      好问题与蠢问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/if_you_cant_get_an_answer/" title="如果得不到回答" class="md-nav__link">
      如果得不到回答
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/how_to_answer_questions_in_a_helpful_way/" title="如何更好地回答问题" class="md-nav__link">
      如何更好地回答问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/how_to_ask_questions_the_smart_way/how_to_ask_questions_the_smart_way/" title="完整版" class="md-nav__link">
      完整版
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      Install WSL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        Install WSL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/wsl/install/" title="安装" class="md-nav__link">
      安装
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/wsl/mklink/" title="mklink软链接到非系统盘" class="md-nav__link">
      mklink软链接到非系统盘
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/wsl/optimization/" title="子系统优化" class="md-nav__link">
      子系统优化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/wsl/questions/" title="杂七杂八问题" class="md-nav__link">
      杂七杂八问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../misc/wsl/reference/" title="参考资料" class="md-nav__link">
      参考资料
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#0x00-magic" title="0x00 magic" class="md-nav__link">
    0x00 magic
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rc4" title="RC4" class="md-nav__link">
    RC4
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check" title="check" class="md-nav__link">
    check
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Alikas0/Alikas0.github.io/edit/master/docs/ctf_write_up/2018/2018rctf.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>2018 RCTF</h1>
                
                <h2 id="0x00-magic">0x00 magic</h2>
<p>题目：<a href="https://raw.githubusercontent.com/Alikas0/CTF/master/challenges/RCTF-magic/magic.exe">magic</a></p>
<p>本题大概有三个任务： 1.找到真正的main函数</p>
<p>2.算出运行时间</p>
<p>3.RC4+VM逆向还原</p>
<p>寻找真正的main函数
拿到题，运行一下，输出如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>D:\Downloads&gt;magic.exe
flag only appears at a specific time, range [2018-05-19 09:00, 2018-05-21 09:00)
Better luck next time :)
</pre></div>
</td></tr></table>

<p>用IDA打开，根据交叉引用即可找到真正的main函数。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">// write access to const memory has been detected, the output may be wrong!</span>
<span class="kt">int</span> <span class="nf">sub_4011B0</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">v0</span><span class="p">;</span> <span class="c1">// rdx</span>
  <span class="kt">signed</span> <span class="kr">__int64</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// rsi</span>
  <span class="kt">signed</span> <span class="kr">__int64</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// rsi</span>
  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// ebp</span>
  <span class="kr">__int64</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// rdx</span>
  <span class="kt">char</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// cl</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">v8</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="kt">char</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// dl</span>
  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// eax</span>
  <span class="kt">int</span> <span class="n">v11</span><span class="p">;</span> <span class="c1">// ebx</span>
  <span class="kt">signed</span> <span class="kr">__int64</span> <span class="n">v12</span><span class="p">;</span> <span class="c1">// r12</span>
  <span class="n">_QWORD</span> <span class="o">*</span><span class="n">v13</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">v14</span><span class="p">;</span> <span class="c1">// rdi</span>
  <span class="kt">size_t</span> <span class="n">v15</span><span class="p">;</span> <span class="c1">// rbp</span>
  <span class="kr">__int64</span> <span class="n">v16</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="kr">__int64</span> <span class="n">v17</span><span class="p">;</span> <span class="c1">// rbx</span>
  <span class="kt">signed</span> <span class="kr">__int64</span> <span class="n">v18</span><span class="p">;</span> <span class="c1">// r13</span>
  <span class="kr">__int64</span> <span class="n">v19</span><span class="p">;</span> <span class="c1">// rcx</span>
  <span class="kt">size_t</span> <span class="n">v20</span><span class="p">;</span> <span class="c1">// rdx</span>
  <span class="kt">int</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// eax</span>
  <span class="kt">char</span> <span class="n">v24</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-A8h]</span>
  <span class="kt">char</span> <span class="n">v25</span><span class="p">;</span> <span class="c1">// [rsp+5Ch] [rbp-6Ch]</span>
  <span class="kt">unsigned</span> <span class="kr">__int16</span> <span class="n">v26</span><span class="p">;</span> <span class="c1">// [rsp+60h] [rbp-68h]</span>

  <span class="n">v0</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">v24</span><span class="p">;</span>
  <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v24</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x68uLL</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">unk_409670</span> <span class="p">)</span>
    <span class="n">GetStartupInfoA</span><span class="p">((</span><span class="n">LPSTARTUPINFOA</span><span class="p">)</span><span class="o">&amp;</span><span class="n">unk_409670</span><span class="p">);</span>
  <span class="n">_RBX</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">unk_409AF8</span><span class="p">;</span>
  <span class="n">v2</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">__readgsqword</span><span class="p">(</span><span class="mh">0x30u</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">_InterlockedCompareExchange</span><span class="p">((</span><span class="k">volatile</span> <span class="kt">signed</span> <span class="kr">__int64</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">unk_409AF8</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">v3</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">v4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">unk_409AF0</span><span class="p">;</span>
      <span class="n">v5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">unk_409AF0</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">goto</span> <span class="n">LABEL_42</span><span class="p">;</span>
      <span class="k">goto</span> <span class="n">LABEL_8</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v2</span> <span class="o">==</span> <span class="n">v3</span> <span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="n">Sleep</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kr">__int64</span><span class="p">)</span><span class="o">&amp;</span><span class="n">unk_409670</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">v4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">unk_409AF0</span><span class="p">;</span>
  <span class="n">v5</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">unk_409AF0</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
  <span class="p">{</span>
<span class="nl">LABEL_42</span><span class="p">:</span>
    <span class="n">amsg_exit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">unk_409670</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unk_409AF0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="mi">31LL</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">unk_409AF0</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span>
      <span class="k">goto</span> <span class="n">LABEL_43</span><span class="p">;</span>
<span class="nl">LABEL_11</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v5</span> <span class="p">)</span>
      <span class="k">goto</span> <span class="n">LABEL_12</span><span class="p">;</span>
    <span class="k">goto</span> <span class="n">LABEL_44</span><span class="p">;</span>
  <span class="p">}</span>
<span class="nl">LABEL_8</span><span class="p">:</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">unk_409AF0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">dword_409004</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">unk_409AF0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">initterm</span><span class="p">(</span><span class="o">&amp;</span><span class="n">unk_409670</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unk_409AF0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unk_40B030</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unk_40B018</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">unk_409AF0</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="k">goto</span> <span class="n">LABEL_11</span><span class="p">;</span>
<span class="nl">LABEL_43</span><span class="p">:</span>
  <span class="n">initterm</span><span class="p">(</span><span class="o">&amp;</span><span class="n">unk_409670</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unk_409AF0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unk_40B010</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unk_40B000</span><span class="p">);</span>
  <span class="n">unk_409AF0</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v5</span> <span class="p">)</span>
    <span class="k">goto</span> <span class="n">LABEL_12</span><span class="p">;</span>
<span class="nl">LABEL_44</span><span class="p">:</span>
  <span class="n">_RAX</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="kr">__asm</span> <span class="p">{</span> <span class="n">xchg</span>    <span class="n">rax</span><span class="p">,</span> <span class="p">[</span><span class="n">rbx</span><span class="p">]</span> <span class="p">}</span>
<span class="nl">LABEL_12</span><span class="p">:</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">TlsCallback_0</span> <span class="p">)</span>
    <span class="n">TlsCallback_0</span><span class="p">(</span><span class="o">&amp;</span><span class="n">unk_409670</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unk_409AF0</span><span class="p">,</span> <span class="mi">2LL</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
  <span class="n">sub_403940</span><span class="p">(</span><span class="o">&amp;</span><span class="n">unk_409670</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unk_409AF0</span><span class="p">,</span> <span class="n">v0</span><span class="p">);</span>
  <span class="n">qword_4096A0</span> <span class="o">=</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="n">SetUnhandledExceptionFilter</span><span class="p">((</span><span class="n">LPTOP_LEVEL_EXCEPTION_FILTER</span><span class="p">)</span><span class="o">&amp;</span><span class="n">unk_409670</span><span class="p">);</span>
  <span class="n">sub_403DA0</span><span class="p">();</span>
  <span class="n">sub_404850</span><span class="p">(</span><span class="o">&amp;</span><span class="n">unk_409670</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">unk_409AF0</span><span class="p">,</span> <span class="n">v6</span><span class="p">,</span> <span class="n">nullsub_1</span><span class="p">);</span>
  <span class="n">sub_403740</span><span class="p">();</span>
  <span class="n">v7</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">qword_4099C8</span> <span class="o">=</span> <span class="mh">0x400000LL</span><span class="p">;</span>
  <span class="n">v8</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">acmdln</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">acmdln</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">v9</span> <span class="o">=</span> <span class="o">*</span><span class="n">v8</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">*</span><span class="n">v8</span> <span class="o">&lt;=</span> <span class="mi">32</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">v9</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="n">v7</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
        <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">v9</span> <span class="p">)</span>
          <span class="p">{</span>
            <span class="k">do</span>
              <span class="o">++</span><span class="n">v8</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span> <span class="o">*</span><span class="n">v8</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">v8</span> <span class="o">&lt;=</span> <span class="mi">32</span> <span class="p">);</span>
          <span class="p">}</span>
          <span class="n">qword_4099C0</span> <span class="o">=</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="n">v8</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">v7</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">v9</span> <span class="o">==</span> <span class="mi">34</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">v7</span> <span class="o">^=</span> <span class="mi">1u</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="o">++</span><span class="n">v8</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">unk_409670</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v10</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v25</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="p">)</span>
      <span class="n">v10</span> <span class="o">=</span> <span class="n">v26</span><span class="p">;</span>
    <span class="n">dword_405000</span> <span class="o">=</span> <span class="n">v10</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">v11</span> <span class="o">=</span> <span class="n">dword_409020</span><span class="p">;</span>
  <span class="n">v12</span> <span class="o">=</span> <span class="mi">8LL</span> <span class="o">*</span> <span class="p">(</span><span class="n">dword_409020</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">v13</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">((</span><span class="kt">size_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">unk_409670</span><span class="p">);</span>
  <span class="n">v14</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">Code</span><span class="p">;</span>
  <span class="n">v15</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="n">v13</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v11</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v16</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)(</span><span class="n">v11</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">v17</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
    <span class="n">v18</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">v16</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
    <span class="k">do</span>
    <span class="p">{</span>
      <span class="n">v19</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v14</span><span class="p">[</span><span class="n">v17</span><span class="p">];</span>
      <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">strlen</span><span class="p">(</span><span class="n">v14</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
      <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">v15</span> <span class="o">+</span> <span class="n">v17</span><span class="p">)</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">((</span><span class="kt">size_t</span><span class="p">)</span><span class="n">v14</span><span class="p">);</span>
      <span class="n">v20</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v14</span><span class="p">[</span><span class="n">v17</span><span class="p">];</span>
      <span class="n">v17</span> <span class="o">+=</span> <span class="mi">8LL</span><span class="p">;</span>
      <span class="n">memcpy</span><span class="p">(</span><span class="n">v14</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="n">v20</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">v18</span> <span class="o">!=</span> <span class="n">v17</span> <span class="p">);</span>
    <span class="n">v13</span> <span class="o">=</span> <span class="p">(</span><span class="n">_QWORD</span> <span class="o">*</span><span class="p">)(</span><span class="n">v15</span> <span class="o">+</span> <span class="n">v12</span> <span class="o">-</span> <span class="mi">8</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="o">*</span><span class="n">v13</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="n">Code</span> <span class="o">=</span> <span class="n">v15</span><span class="p">;</span>
  <span class="n">sub_403310</span><span class="p">((</span><span class="kr">__int64</span><span class="p">)</span><span class="n">v14</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span> <span class="o">*</span><span class="p">)</span><span class="n">v4</span><span class="p">);</span><span class="c1">//real入口点0.0</span>
  <span class="n">_initenv</span> <span class="o">=</span> <span class="n">qword_409010</span><span class="p">;</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">main</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">v14</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="p">)</span><span class="n">v4</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="p">)</span><span class="n">Code</span><span class="p">);</span>
  <span class="n">dword_40900C</span> <span class="o">=</span> <span class="n">result</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">dword_409008</span> <span class="p">)</span>
    <span class="n">exit</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">v14</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">dword_409004</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">cexit</span><span class="p">();</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">dword_40900C</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>进去sub_403310函数：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">sub_403310</span><span class="p">(</span><span class="kr">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="kr">__int64</span> <span class="o">*</span><span class="n">a2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kr">__int64</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// rax</span>

  <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">dword_4090A0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">dword_4090A0</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">dword_4090A0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sub_4032A0</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">);</span><span class="c1">//这里进去</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">sub_4032A0</span><span class="p">(</span><span class="kr">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="kr">__int64</span> <span class="o">*</span><span class="n">a2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kr">__int64</span> <span class="n">v2</span><span class="p">;</span> <span class="c1">// rdx</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// eax</span>
  <span class="kr">__int64</span> <span class="o">*</span><span class="n">v4</span><span class="p">;</span> <span class="c1">// rbx</span>

  <span class="n">v2</span> <span class="o">=</span> <span class="n">qword_4049A0</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">qword_4049A0</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">LODWORD</span><span class="p">(</span><span class="n">qword_4049A0</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">v2</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">v2</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">qword_4049A0</span><span class="p">[</span><span class="n">v2</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">qword_4049A0</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">qword_4049A0</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int64</span><span class="p">)(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
    <span class="k">do</span>
    <span class="p">{</span>
      <span class="p">((</span><span class="kt">void</span> <span class="p">(</span><span class="kr">__fastcall</span> <span class="o">*</span><span class="p">)(</span><span class="kr">__int64</span><span class="p">,</span> <span class="kr">__int64</span> <span class="o">*</span><span class="p">))</span><span class="o">*</span><span class="n">v4</span><span class="p">)(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">);</span>
      <span class="o">--</span><span class="n">v4</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">!=</span> <span class="n">a2</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">sub_403240</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">sub_403260</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
qword_4049A0存放了两个函数的地址：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>qword_4049A0    dq 0FFFFFFFFFFFFFFFFh, 402357h, 404990h, 0
</pre></div>
</td></tr></table>

<p>进去sub_402357</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">sub_402357</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">a2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kr">__int64</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// ST2C_4</span>

  <span class="n">Time</span><span class="p">((</span><span class="kr">__int64</span><span class="p">)</span><span class="n">a1</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="n">a2</span><span class="p">);</span><span class="c1">//第一步，时间验证</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">dword_4099D0</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">dword_4099D0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">strtol</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">^</span> <span class="mh">0xBADD1917</span><span class="p">;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sub_402218</span><span class="p">((</span><span class="kr">__int64</span><span class="p">)</span><span class="n">a1</span><span class="p">,</span> <span class="p">(</span><span class="n">_DWORD</span><span class="p">)</span><span class="n">a2</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int64</span><span class="p">)</span><span class="o">&amp;</span><span class="n">unk_405220</span><span class="p">);</span><span class="c1">//输出flag only.....</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Time正是这个程序的第一步验证：时间验证</p>
<p>而sub_402218则是输出信息的位置。</p>
<p>以上由调试可知，就不赘述了。</p>
<p>时间验证</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">Time</span><span class="p">(</span><span class="n">__time64_t</span> <span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kr">__int64</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-10h]</span>
  <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+24h] [rbp-Ch]</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-8h]</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+2Ch] [rbp-4h]</span>

  <span class="n">v5</span> <span class="o">=</span> <span class="n">time64</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v5</span> <span class="o">&lt;=</span> <span class="mh">0x5AFFE78F</span> <span class="o">||</span> <span class="n">v5</span> <span class="o">&gt;</span> <span class="mh">0x5B028A8F</span> <span class="p">)</span>
    <span class="k">return</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="n">srand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">a1</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
    <span class="n">byte_405020</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="n">rand</span><span class="p">();</span>
  <span class="n">v4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">sub_4027ED</span><span class="p">((</span><span class="kr">__int64</span><span class="p">)</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v4</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="n">byte_405020</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v3</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">==</span> <span class="mh">0x700</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">dword_4099D0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v3</span><span class="p">;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">v3</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">dword_4099D0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0LL</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>time64函数返回当前时间戳，根据这段代码，返回的时间戳应该在(0x5AFFE78F,0x5B028A8F]这个范围内程序才会继续执行。</p>
<p>其后以时间戳做为随机数种子，取随机数对byte405020数组异或运算，再通过sub4027ED这个函数对byte_405020数组进行一些运算，最终得到v4的值，并判断v4的值是否等于0x700.</p>
<p>在后面的代码中可知，如果result ==0，那么程序将打印出</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>flag only appears at a specific time, range [2018-05-19 09:00, 2018-05-21 09:00)
Better luck next time :)
</pre></div>
</td></tr></table>

<p>并退出。观察到0x5B028A8F - 0x5AFFE78F = 0x2A300，所以time的范围算是比较小的了，我们可以修改程序代码，让程序自己跑出time。</p>
<p>修改如下：（IDA修改指令快捷键为Ctrl+Alt+K，修改后patch上去即可。剩下的就看各位的汇编功底了！）</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">sub_402268</span><span class="p">(</span><span class="kr">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// edx</span>
  <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// [rsp+24h] [rbp-Ch]</span>
  <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [rsp+28h] [rbp-8h]</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+2Ch] [rbp-4h]</span>

  <span class="n">v5</span> <span class="o">=</span> <span class="mh">0x5AFFE790</span><span class="p">;</span>
  <span class="k">do</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="o">++</span><span class="n">v5</span> <span class="o">&gt;</span> <span class="mh">0x5B028A8F</span> <span class="p">)</span>
      <span class="k">return</span> <span class="mi">0LL</span><span class="p">;</span>
    <span class="n">srand</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
      <span class="n">byte_405120</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">^</span> <span class="n">byte_405020</span><span class="p">[</span><span class="n">i</span><span class="p">];</span><span class="c1">//这里我取用了byte_405120来存放每次异或的值，所以这个修改吧，是永久的0.0，要么另起一个程序要么记得这里改回来0.0</span>
    <span class="n">v4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">sub_4027ED</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v4</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">while</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">!=</span> <span class="mi">1792</span> <span class="p">);</span>
  <span class="n">dword_4099D0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v3</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0LL</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>在dword_4099D0[0] = v3;处下断，即可跑出时间：0x5b00e398</p>
<p>为了接下来方便调试，直接将v5设置为0x5b00e398，即可进入第二步验证：输入验证</p>
<p>输入验证
经过调试，找到输入验证的函数</p>
<p>__</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nv">int64</span> <span class="nv">__fastcall</span> <span class="nv">sub_4023B1</span><span class="ss">(</span><span class="nv">const</span> <span class="nv">char</span> <span class="o">*</span><span class="nv">a1</span>, <span class="nv">__int64</span> <span class="nv">a2</span><span class="ss">)</span>
{
  <span class="nv">__int64</span> <span class="nv">v3</span><span class="c1">; // [rsp+20h] [rbp-30h]</span>
  <span class="nv">__int64</span> <span class="nv">v4</span><span class="c1">; // [rsp+28h] [rbp-28h]</span>
  <span class="nv">__int64</span> <span class="nv">v5</span><span class="c1">; // [rsp+30h] [rbp-20h]</span>
  <span class="nv">__int64</span> <span class="nv">v6</span><span class="c1">; // [rsp+38h] [rbp-18h]</span>
  <span class="nv">unsigned</span> <span class="nv">int</span> <span class="nv">v7</span><span class="c1">; // [rsp+43h] [rbp-Dh]</span>
  <span class="nv">char</span> <span class="nv">v8</span><span class="c1">; // [rsp+47h] [rbp-9h]</span>
  <span class="nv">__int64</span> <span class="o">*</span><span class="nv">Count</span><span class="c1">; // [rsp+48h] [rbp-8h]</span>

  <span class="k">if</span> <span class="ss">(</span> <span class="o">!</span><span class="nv">dword_4099D0</span>[<span class="mi">0</span>] <span class="ss">)</span>
    <span class="k">exit</span><span class="ss">((</span><span class="nv">int</span><span class="ss">)</span><span class="nv">a1</span><span class="ss">)</span><span class="c1">;</span>
  <span class="nv">v8</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">;</span>
  <span class="nv">v7</span> <span class="o">=</span> <span class="nv">dword_4099D0</span>[<span class="mi">0</span>]<span class="c1">;</span>
  <span class="nv">sub_402218</span><span class="ss">(</span><span class="nv">a1</span>, <span class="nv">a2</span>, <span class="mi">49</span>, <span class="ss">(</span><span class="nv">__int64</span><span class="ss">)</span><span class="o">&amp;</span><span class="nv">unk_4052A0</span>, <span class="nv">dword_4099D0</span>[<span class="mi">0</span>]<span class="ss">)</span><span class="c1">;</span>
  <span class="nv">v3</span> <span class="o">=</span> <span class="mi">0</span><span class="nv">LL</span><span class="c1">;</span>
  <span class="nv">v4</span> <span class="o">=</span> <span class="mi">0</span><span class="nv">LL</span><span class="c1">;</span>
  <span class="nv">v5</span> <span class="o">=</span> <span class="mi">0</span><span class="nv">LL</span><span class="c1">;</span>
  <span class="nv">v6</span> <span class="o">=</span> <span class="mi">0</span><span class="nv">LL</span><span class="c1">;</span>
  <span class="nv">Count</span> <span class="o">=</span> <span class="ss">(</span><span class="nv">__int64</span> <span class="o">*</span><span class="ss">)((</span><span class="nv">char</span> <span class="o">*</span><span class="ss">)</span><span class="o">&amp;</span><span class="nv">v3</span> <span class="o">+</span> <span class="mi">4</span><span class="ss">)</span><span class="c1">;</span>
  <span class="nv">scanf</span><span class="ss">(</span><span class="nv">a1</span>, <span class="nv">a2</span>, <span class="ss">(</span><span class="nv">char</span> <span class="o">*</span><span class="ss">)</span><span class="o">&amp;</span><span class="nv">v3</span> <span class="o">+</span> <span class="mi">4</span>, <span class="s2">&quot;</span><span class="s">%26s</span><span class="s2">&quot;</span><span class="ss">)</span><span class="c1">;</span>
  <span class="nv">RC4</span><span class="ss">((</span><span class="nv">__int64</span><span class="ss">)</span><span class="nv">a1</span>, <span class="nv">a2</span>, <span class="mi">26</span><span class="nv">LL</span>, <span class="ss">(</span><span class="nv">__int64</span><span class="ss">)</span><span class="nv">Count</span>, <span class="ss">(</span><span class="nv">unsigned</span> <span class="nv">__int64</span><span class="ss">)</span><span class="o">&amp;</span><span class="nv">v7</span><span class="ss">)</span><span class="c1">;</span>
  <span class="k">if</span> <span class="ss">(</span> <span class="o">!</span><span class="ss">(</span><span class="nv">unsigned</span> <span class="nv">int</span><span class="ss">)</span><span class="nv">check</span><span class="ss">((</span><span class="nv">size_t</span><span class="ss">)</span><span class="nv">a1</span><span class="ss">)</span> <span class="ss">)</span>
    <span class="k">return</span> <span class="nv">sub_402218</span><span class="ss">(</span><span class="nv">a1</span>, <span class="nv">a2</span>, <span class="mi">6</span>, <span class="ss">(</span><span class="nv">__int64</span><span class="ss">)</span><span class="nv">aC</span>, <span class="nv">dword_4099D0</span>[<span class="mi">0</span>]<span class="ss">)</span><span class="c1">;</span>
  <span class="nv">RC4</span><span class="ss">((</span><span class="nv">__int64</span><span class="ss">)</span><span class="nv">a1</span>, <span class="nv">a2</span>, <span class="mi">26</span><span class="nv">LL</span>, <span class="ss">(</span><span class="nv">__int64</span><span class="ss">)</span><span class="nv">Count</span>, <span class="ss">(</span><span class="nv">unsigned</span> <span class="nv">__int64</span><span class="ss">)</span><span class="o">&amp;</span><span class="nv">v7</span><span class="ss">)</span><span class="c1">;</span>
  <span class="nv">sub_401FFB</span><span class="ss">(</span><span class="nv">a1</span><span class="ss">)</span><span class="c1">;</span>
  <span class="nv">sub_402218</span><span class="ss">(</span><span class="nv">a1</span>, <span class="nv">a2</span>, <span class="mi">35</span>, <span class="ss">(</span><span class="nv">__int64</span><span class="ss">)</span><span class="o">&amp;</span><span class="nv">unk_4052E0</span>, <span class="nv">dword_4099D0</span>[<span class="mi">0</span>]<span class="ss">)</span><span class="c1">;</span>
  <span class="nv">puts</span><span class="ss">(</span><span class="nv">a1</span><span class="ss">)</span><span class="c1">;</span>
  <span class="k">return</span> <span class="nv">sub_402218</span><span class="ss">(</span><span class="nv">a1</span>, <span class="nv">a2</span>, <span class="mi">35</span>, <span class="ss">(</span><span class="nv">__int64</span><span class="ss">)</span><span class="o">&amp;</span><span class="nv">unk_4052E0</span>, <span class="nv">dword_4099D0</span>[<span class="mi">0</span>]<span class="ss">)</span><span class="c1">;</span>
}
</pre></div>
</td></tr></table>

<h3 id="rc4">RC4</h3>
<p>RC4的辨识度较高：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">RC4</span><span class="p">(</span><span class="kr">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a2</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a3</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a4</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a5</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a6</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">_QWORD</span> <span class="o">*</span><span class="n">v6</span><span class="p">;</span> <span class="c1">// rdi</span>
  <span class="kr">__int64</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// [rsp+0h] [rbp-80h]</span>
  <span class="kt">char</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// [rsp+20h] [rbp-60h]</span>
  <span class="kr">__int64</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// [rsp+140h] [rbp+C0h]</span>

  <span class="n">v10</span> <span class="o">=</span> <span class="n">a4</span><span class="p">;</span>
  <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v8</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x100uLL</span><span class="p">);</span>
  <span class="n">v6</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">v8</span> <span class="o">+</span> <span class="mi">36</span><span class="p">;</span>
  <span class="n">sub_401C67</span><span class="p">((</span><span class="kr">__int64</span><span class="p">)</span><span class="n">v6</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a5</span><span class="p">,</span> <span class="p">(</span><span class="kr">__int64</span><span class="p">)</span><span class="o">&amp;</span><span class="n">v9</span><span class="p">,</span> <span class="n">a6</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">sub_401E02</span><span class="p">((</span><span class="kr">__int64</span><span class="p">)</span><span class="n">v6</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">v10</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>在sub_401C67中密钥扩展：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="kt">signed</span> <span class="kt">int</span><span class="p">)</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">255</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)((</span><span class="kt">signed</span> <span class="kt">int</span><span class="p">)</span><span class="n">i</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span><span class="c1">//这里每一位都赋值位数</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="kt">signed</span> <span class="kt">int</span><span class="p">)</span><span class="n">i</span><span class="p">;</span>
    <span class="n">v7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">i</span> <span class="o">%</span> <span class="n">a5</span> <span class="o">+</span> <span class="n">a3</span><span class="p">);</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>在sub_401E02中的加密运算：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">sub_401E02</span><span class="p">(</span><span class="kr">__int64</span> <span class="n">a1</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a2</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a3</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a4</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a5</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// eax</span>
  <span class="kt">char</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// ST0F_1</span>
  <span class="kr">__int64</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// rax</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [rsp+14h] [rbp-Ch]</span>
  <span class="kt">int</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// [rsp+18h] [rbp-8h]</span>
  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// [rsp+1Ch] [rbp-4h]</span>

  <span class="n">v10</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v9</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">a5</span> <span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="n">v10</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)(((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)((</span><span class="n">v10</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">31</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="n">v10</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)((</span><span class="n">v10</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">31</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">);</span>
    <span class="n">v5</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)((</span><span class="n">v9</span> <span class="o">+</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="n">v10</span> <span class="o">+</span> <span class="n">a4</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">31</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">;</span>
    <span class="n">v9</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)(</span><span class="n">v5</span> <span class="o">+</span> <span class="n">v9</span> <span class="o">+</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v10</span> <span class="o">+</span> <span class="n">a4</span><span class="p">))</span> <span class="o">-</span> <span class="n">v5</span><span class="p">;</span>
    <span class="n">v6</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v10</span> <span class="o">+</span> <span class="n">a4</span><span class="p">);</span>
    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v10</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v9</span> <span class="o">+</span> <span class="n">a4</span><span class="p">);</span>
    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">a4</span> <span class="o">+</span> <span class="n">v9</span><span class="p">)</span> <span class="o">=</span> <span class="n">v6</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">i</span> <span class="o">+</span> <span class="n">a3</span><span class="p">)</span> <span class="o">^=</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)((</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v10</span> <span class="o">+</span> <span class="n">a4</span><span class="p">)</span> <span class="o">+</span> <span class="o">*</span><span class="p">(</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)(</span><span class="n">v9</span> <span class="o">+</span> <span class="n">a4</span><span class="p">))</span> <span class="o">+</span> <span class="n">a4</span><span class="p">);</span><span class="c1">//这里每一位都异或运算后的密钥，所以RC4甚至可以直接导出这里的异或数组</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="check">check</h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">__int64</span> <span class="kr">__fastcall</span> <span class="nf">check</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">Count</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">a2</span><span class="p">,</span> <span class="kr">__int64</span> <span class="n">a3</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">input</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// eax</span>
  <span class="kr">__int64</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// rdx</span>
  <span class="kt">int</span> <span class="n">v6</span><span class="p">;</span> <span class="c1">// ST12C_4</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">v8</span><span class="p">;</span> <span class="c1">// [rsp+124h] [rbp-Ch]</span>
  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// [rsp+128h] [rbp-8h]</span>
  <span class="kt">int</span> <span class="n">v10</span><span class="p">;</span> <span class="c1">// [rsp+12Ch] [rbp-4h]</span>

  <span class="n">strncpy</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">Count</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
  <span class="n">signal</span><span class="p">(</span><span class="n">Count</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="p">(</span><span class="kr">__cdecl</span> <span class="o">*</span><span class="p">)(</span><span class="kt">int</span><span class="p">))</span><span class="n">a2</span><span class="p">);</span>
  <span class="n">v10</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v9</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">v8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">r1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int64</span><span class="p">)</span><span class="o">&amp;</span><span class="n">byte_405320</span><span class="p">;</span><span class="c1">//const常量</span>
  <span class="n">LODWORD</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int64</span><span class="p">)</span><span class="o">&amp;</span><span class="n">input_RC4</span><span class="p">;</span><span class="c1">//RC4后的输入</span>
  <span class="k">while</span> <span class="p">(</span> <span class="n">v9</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">v4</span> <span class="o">=</span> <span class="n">setjmp</span><span class="p">((</span><span class="n">_JBTYPE</span> <span class="o">*</span><span class="p">)</span><span class="n">Count</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">==</span> <span class="mh">0xA8</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="p">(</span><span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">))</span> <span class="o">-=</span> <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="p">(</span><span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">));</span><span class="c1">// A8</span>
      <span class="o">++</span><span class="n">v10</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">&gt;</span> <span class="mh">0xA8</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">==</span> <span class="mh">0xAC</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="p">(</span><span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">))</span> <span class="o">&amp;=</span> <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="p">(</span><span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">));</span>
        <span class="o">++</span><span class="n">v10</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">&gt;</span> <span class="mh">0xAC</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">==</span> <span class="mh">0xAE</span> <span class="p">)</span>
        <span class="p">{</span>
          <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="p">(</span><span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">))</span> <span class="o">^=</span> <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="p">(</span><span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">));</span>
          <span class="o">++</span><span class="n">v10</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">&lt;</span> <span class="mh">0xAE</span> <span class="p">)</span>                   <span class="c1">// AD</span>
        <span class="p">{</span>
          <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">])</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="o">~*</span><span class="p">((</span><span class="n">_BYTE</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]);</span>
          <span class="o">++</span><span class="n">v10</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">!=</span> <span class="mh">0xAF</span> <span class="p">)</span>
            <span class="k">goto</span> <span class="n">LABEL_43</span><span class="p">;</span>
          <span class="n">cmp_0</span> <span class="o">=</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
          <span class="n">cmp_1</span> <span class="o">=</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">setjmp</span><span class="p">((</span><span class="n">_JBTYPE</span> <span class="o">*</span><span class="p">)</span><span class="n">Count</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmp_0</span> <span class="o">/</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
          <span class="n">v10</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">==</span> <span class="mh">0xAA</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">])</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
        <span class="n">v10</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">&gt;</span> <span class="mh">0xAA</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">])</span> <span class="o">=</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
        <span class="n">v10</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="p">(</span><span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">))</span> <span class="o">+=</span> <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="p">(</span><span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">));</span>
        <span class="o">++</span><span class="n">v10</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">==</span> <span class="mh">0xA3</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="p">(</span><span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">))</span> <span class="o">|=</span> <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="p">(</span><span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">));</span>
      <span class="o">++</span><span class="n">v10</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">&gt;</span> <span class="mh">0xA3</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">==</span> <span class="mh">0xA6</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">r5</span> <span class="p">)</span>
          <span class="n">v10</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">];</span>
        <span class="o">++</span><span class="n">v10</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">&gt;</span> <span class="mh">0xA6</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">r5</span> <span class="p">)</span>
          <span class="n">v10</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">];</span>
        <span class="o">++</span><span class="n">v10</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">!=</span> <span class="mh">0xA5</span> <span class="p">)</span>
          <span class="k">goto</span> <span class="n">LABEL_43</span><span class="p">;</span>
        <span class="n">v10</span> <span class="o">+=</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">==</span> <span class="mh">0xA0</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">])</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kr">__int8</span> <span class="o">*</span><span class="p">)(</span><span class="kt">signed</span> <span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]);</span>
      <span class="o">++</span><span class="n">v10</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">==</span> <span class="mh">0xA2</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">v6</span> <span class="o">=</span> <span class="n">v10</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v6</span><span class="p">])</span> <span class="o">&gt;&gt;=</span> <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v6</span><span class="p">]);</span>
      <span class="n">v10</span> <span class="o">=</span> <span class="n">v6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">v4</span> <span class="p">)</span>
      <span class="p">{</span>
        <span class="n">v5</span> <span class="o">=</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">];</span>
        <span class="n">longjmp_0</span><span class="p">((</span><span class="n">_JBTYPE</span> <span class="o">*</span><span class="p">)</span><span class="n">Count</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">a2</span><span class="p">);</span>
      <span class="p">}</span>
<span class="nl">LABEL_43</span><span class="p">:</span>
      <span class="n">v9</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">v8</span> <span class="o">=</span> <span class="n">r5</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">v8</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>则调试分析，如下：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>.bss:0000000000409040 r0              dd ?                    ; DATA XREF: sub_402930+32↑o
.bss:0000000000409040                                         ; sub_402930+4C↑o ...
.bss:0000000000409044 r1              dd ?                    ; DATA XREF: check+52↑w
.bss:0000000000409048 ; _DWORD *r2
.bss:0000000000409048 r2              dd ?                    ; DATA XREF: check+5F↑w
.bss:000000000040904C r3              dd ?
.bss:0000000000409050 r4              dd ?
.bss:0000000000409054 r5              dd ?                    ; DATA XREF: check:loc_403073↑r
.bss:0000000000409054                                         ; check:loc_40309A↑r ...
.bss:0000000000409058 r6              dd ?
.bss:000000000040905C                 dd ?
.bss:0000000000409060 cmp_0           dd ?                    ; DATA XREF: sub_402930+22↑r
.bss:0000000000409060                                         ; sub_402930+5B↑r ...
.bss:0000000000409064 cmp_1           dd ?                    ; DATA XREF: sub_402930+3C↑r
.bss:0000000000409064                                         ; check+35A↑w
</pre></div>
</td></tr></table>

<p>AF的操作并不在0xAF中,因为这里的除数永远等于0，所以AF的操作在前面的除0异常处理signal中，这里有点坑，IDA分析出来的和实际汇编代码看着不太一样。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">else</span>
        <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span> <span class="n">v4</span> <span class="o">!=</span> <span class="mh">0xAF</span> <span class="p">)</span>
            <span class="k">goto</span> <span class="n">LABEL_43</span><span class="p">;</span>
          <span class="n">cmp_0</span> <span class="o">=</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
          <span class="n">cmp_1</span> <span class="o">=</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">setjmp</span><span class="p">((</span><span class="n">_JBTYPE</span> <span class="o">*</span><span class="p">)</span><span class="n">Count</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmp_0</span> <span class="o">/</span> <span class="n">opcode</span><span class="p">[</span><span class="n">v10</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
          <span class="n">v10</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span>
</pre></div>
</td></tr></table>

<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nl">.text:</span><span class="err">00000000004029</span><span class="nf">EC</span>                 <span class="no">lea</span>     <span class="no">rdx</span><span class="p">,</span> <span class="no">sub_402930</span>
<span class="nl">.text:</span><span class="err">00000000004029</span><span class="nf">F3</span>                 <span class="no">mov</span>     <span class="no">ecx</span><span class="p">,</span> <span class="mi">8</span>
<span class="nl">.text:</span><span class="err">00000000004029</span><span class="nf">F8</span>                 <span class="no">call</span>    <span class="no">signal</span>
</pre></div>
</td></tr></table>

<p>在sub_402930中：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="kr">__fastcall</span> <span class="n">__noreturn</span> <span class="nf">sub_402930</span><span class="p">(</span><span class="n">_JBTYPE</span> <span class="o">*</span><span class="n">a1</span><span class="p">,</span> <span class="kt">void</span> <span class="p">(</span><span class="kr">__cdecl</span> <span class="o">*</span><span class="n">a2</span><span class="p">)(</span><span class="kt">int</span><span class="p">),</span> <span class="kr">__int64</span> <span class="n">a3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">a4</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">a4</span> <span class="o">==</span> <span class="mi">8</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">signal</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">);</span>
    <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="n">cmp_0</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="n">cmp_0</span><span class="p">)</span> <span class="o">==</span> <span class="o">*</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r0</span> <span class="o">+</span> <span class="n">cmp_1</span><span class="p">);</span>
    <span class="n">longjmp_0</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">a2</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">exit</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">a1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>最终，opcode为：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">AB</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="err">:</span><span class="w"> </span><span class="n">mov</span><span class="w"> </span><span class="n">r3</span><span class="p">,</span><span class="mh">0x00</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">AB</span><span class="w"> </span><span class="mi">04</span><span class="w"> </span><span class="mi">1</span><span class="n">A</span><span class="w">  </span><span class="err">:</span><span class="w"> </span><span class="n">mov</span><span class="w"> </span><span class="n">r4</span><span class="p">,</span><span class="mh">0x1A</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">AB</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">66</span><span class="w">  </span><span class="err">:</span><span class="w"> </span><span class="n">mov</span><span class="w"> </span><span class="n">r0</span><span class="p">,</span><span class="mh">0x66</span><span class="w"></span>
<span class="w"> </span><span class="nl">s1</span><span class="p">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">AA</span><span class="w"> </span><span class="mi">05</span><span class="w"> </span><span class="mi">02</span><span class="w">  </span><span class="err">:</span><span class="w"> </span><span class="n">mov</span><span class="w"> </span><span class="n">r5</span><span class="p">,</span><span class="w"> </span><span class="n">r2</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">A9</span><span class="w"> </span><span class="mi">53</span><span class="w">     </span><span class="err">:</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="n">r5</span><span class="p">,</span><span class="n">r3</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">A0</span><span class="w"> </span><span class="mi">05</span><span class="w">     </span><span class="err">:</span><span class="w"> </span><span class="n">mov</span><span class="w"> </span><span class="n">r5</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="n">r5</span><span class="o">]</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">AB</span><span class="w"> </span><span class="mi">06</span><span class="w"> </span><span class="n">CC</span><span class="w">  </span><span class="err">:</span><span class="w"> </span><span class="n">mov</span><span class="w"> </span><span class="n">r6</span><span class="p">,</span><span class="mh">0xCC</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">A9</span><span class="w"> </span><span class="mi">56</span><span class="w">     </span><span class="err">:</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="n">r5</span><span class="p">,</span><span class="n">r6</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">AB</span><span class="w"> </span><span class="mi">06</span><span class="w"> </span><span class="n">FF</span><span class="w">  </span><span class="err">:</span><span class="w"> </span><span class="n">mov</span><span class="w"> </span><span class="n">r6</span><span class="p">,</span><span class="mh">0xFF</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">AC</span><span class="w"> </span><span class="mi">56</span><span class="w">     </span><span class="err">:</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">r5</span><span class="p">,</span><span class="n">r6</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">AE</span><span class="w"> </span><span class="mi">50</span><span class="w">     </span><span class="err">:</span><span class="w"> </span><span class="n">xor</span><span class="w"> </span><span class="n">r5</span><span class="p">,</span><span class="n">r0</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">AD</span><span class="w"> </span><span class="mi">00</span><span class="w">     </span><span class="err">:</span><span class="w"> </span><span class="n">r0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">r0</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">AA</span><span class="w"> </span><span class="mi">06</span><span class="w"> </span><span class="mi">05</span><span class="w">  </span><span class="err">:</span><span class="w"> </span><span class="n">mov</span><span class="w"> </span><span class="n">r6</span><span class="p">,</span><span class="n">r5</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">AA</span><span class="w"> </span><span class="mi">05</span><span class="w"> </span><span class="mi">01</span><span class="w">  </span><span class="err">:</span><span class="w"> </span><span class="n">mov</span><span class="w"> </span><span class="n">r5</span><span class="p">,</span><span class="n">r1</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">A9</span><span class="w"> </span><span class="mi">53</span><span class="w">     </span><span class="err">:</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="n">r5</span><span class="p">,</span><span class="n">r3</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">A0</span><span class="w"> </span><span class="mi">05</span><span class="w">     </span><span class="err">:</span><span class="w"> </span><span class="n">mov</span><span class="w"> </span><span class="n">r5</span><span class="p">,</span><span class="o">[</span><span class="n">r5</span><span class="o">]</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">AF</span><span class="w"> </span><span class="mi">56</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="err">:</span><span class="w"> </span><span class="n">cmp</span><span class="w"> </span><span class="n">r5</span><span class="p">,</span><span class="n">r6</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">A7</span><span class="w"> </span><span class="mi">01</span><span class="w">     </span><span class="err">:</span><span class="w"> </span><span class="n">jz</span><span class="w">  </span><span class="n">s2</span><span class="w"></span>
<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">CC</span><span class="w">  </span>
<span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="err">:</span><span class="w"></span>
<span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">A9</span><span class="w"> </span><span class="mi">35</span><span class="w">     </span><span class="err">:</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="n">r3</span><span class="p">,</span><span class="n">r5</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">AA</span><span class="w"> </span><span class="mi">05</span><span class="w"> </span><span class="mi">03</span><span class="w">  </span><span class="err">:</span><span class="w"> </span><span class="n">mov</span><span class="w"> </span><span class="n">r5</span><span class="p">,</span><span class="n">r3</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">AF</span><span class="w"> </span><span class="mi">54</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="err">:</span><span class="w"> </span><span class="n">cmp</span><span class="w"> </span><span class="n">r5</span><span class="p">,</span><span class="n">r4</span><span class="w"></span>
<span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">A6</span><span class="w"> </span><span class="n">D1</span><span class="w">     </span><span class="err">:</span><span class="w"> </span><span class="n">jnz</span><span class="w"> </span><span class="n">s1</span><span class="w"></span>
<span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">CC</span><span class="w">  </span>
</pre></div>
</td></tr></table>

<p>写成python大概是这样：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">for</span> <span class="n">r3</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">26</span><span class="p">):</span>
    <span class="n">r5</span> <span class="o">+=</span> <span class="mh">0xCC</span>
    <span class="n">r5</span> <span class="o">&amp;=</span> <span class="mh">0xFF</span>
    <span class="n">r5</span> <span class="o">^=</span> <span class="n">r0</span>
    <span class="n">r0</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">r0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
    <span class="n">r6</span> <span class="o">=</span> <span class="n">r5</span>
    <span class="n">r5</span> <span class="o">=</span> <span class="n">const</span><span class="p">[</span><span class="n">r3</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">r5</span> <span class="o">!=</span> <span class="n">r6</span> <span class="p">:</span>
        <span class="k">break</span>
    <span class="n">r3</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">r5</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="n">r3</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<p>则求出RC4之后的输入为：</p>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">const</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xC1</span><span class="p">,</span> <span class="mh">0xEC</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0x3A</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0xE4</span><span class="p">,</span> <span class="mh">0xE6</span><span class="p">,</span> 
  <span class="mh">0xE4</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0xCB</span><span class="p">,</span> <span class="mh">0xD9</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0xAE</span><span class="p">,</span> <span class="mh">0x9D</span><span class="p">,</span> <span class="mh">0x7C</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> 
  <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x8F</span><span class="p">,</span> <span class="mh">0x1B</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0xE8</span><span class="p">]</span>

<span class="n">r0</span> <span class="o">=</span> <span class="mh">0x66</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">26</span><span class="p">):</span>
    <span class="n">r5</span> <span class="o">=</span> <span class="n">const</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">r5</span> <span class="o">^=</span> <span class="n">r0</span>
    <span class="n">r5</span> <span class="o">=</span> <span class="p">(</span><span class="n">r5</span> <span class="o">-</span> <span class="mh">0xCC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
    <span class="n">r0</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">r0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">x&#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">r5</span><span class="p">)[</span><span class="mi">2</span><span class="p">:],</span><span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table>
RC4解密：</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">ARC4</span>
<span class="n">key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xA4\xE7\x2C\x32</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="mi">4</span>

<span class="n">obj</span> <span class="o">=</span> <span class="n">ARC4</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="nb">input</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x23\x8c\xbe\xfd\x25\xd7\x65\xf4\xb6\xb3\xb6\x0f\xe1\x74\xa2\xef\xfc\x38\x4e\xd2\x1a\x4a\xb1\x10\x96\xa5</span><span class="s2">&quot;</span>

<span class="k">print</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="nb">input</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<p>得到输入：@ck<em>For</em>fun<em>02508iO2</em>2iOR}，输入后输出以下信息，摘掉眼镜打开高清视界0.0</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>the part of flag was protected by a magic spell!
@ck_For_fun_02508iO2_2iOR}
.843fFDCb52bc573DA7e336b4BCC97C6E.
.1adC4b19FEBA1Bf9D182FAe8Eac1AeBF.
.CB7EEFeD2B2D6dd76f   bE  D0 ec92.
.DD1C36EDBaf56 63b6 ad83 f5D a60D.
.28CCE56eaBbcF 0Bb9 ed7F 669 aff7.
.    dC   83     4    bf a01     .
.  DAB 2a0 CBD eB74 9eF6 0De 1Bf .
.  E15 d55A276 7A4c fA7 eE72 dc7 .
.  afB bE0fa2e 7Bf9 Eb14 6A5 891 .
.  DCf c907BF9 aFBB 28eA 4dE aB1 .
.  B25 c5B 16d d90f 0cb0 D78 Edd .
.  aEA7   eDaD   07 743A 935 27d .
.D38f5b1FacEaBDeFBEEcbA4 0b9D0A0f.
.ce1A5DFCe012a0a62A5e2D8  8e38C9A.
.CC1b26fF12fC01f8aeB7cAC06c65FCbe.
.e663471A878EcE289bee7c11d7f8CF7b.
.--------------------------------.
    @ck_For_fun_02508iO2_2iOR}
.--------------------------------.
</pre></div>
</td></tr></table>

<p>最终flag为：rctf{h@ck<em>For</em>fun<em>02508iO2</em>2iOR}</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../../links/" title="友情链接" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  上一页
                </span>
                友情链接
              </span>
            </div>
          </a>
        
        
          <a href="../../2019/2019aurora/" title="2019 Aurora内部赛" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  下一页
                </span>
                2019 Aurora内部赛
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/Alikas0" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://t.me/Alikas" class="md-footer-social__link fa fa-telegram"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.245445c6.js"></script>
      
        
        
          
          <script src="../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="../../../js/extra.js"></script>
      
    
  </body>
</html>